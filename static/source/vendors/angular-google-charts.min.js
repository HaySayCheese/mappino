/**
 * @description Google Chart Api Directive Module for AngularJS
 * @version 0.0.10
 * @author Nicolas Bouillon <nicolas@bouil.org>
 * @author GitHub contributors
 * @license MIT
 * @year 2013
 */
(function(k,p,l){l.module("googlechart",[]).value("googleChartApiConfig",{version:"1",optionalSettings:{packages:["corechart"]}}).provider("googleJsapiUrl",function(){var d="https:",c="//www.google.com/jsapi";this.setProtocol=function(c){d=c};this.setUrl=function(d){c=d};this.$get=function(){return(d?d:"")+c}}).factory("googleChartApiPromise",["$rootScope","$q","googleChartApiConfig","googleJsapiUrl",function(d,c,m,q){var a=c.defer(),r=function(){var c={callback:function(){var c=m.optionalSettings.callback;
    d.$apply(function(){a.resolve()});l.isFunction(c)&&c.call(this)}},c=l.extend({},m.optionalSettings,c);p.google.load("visualization",m.version,c)};c=k.getElementsByTagName("head")[0];var e=k.createElement("script");e.setAttribute("type","text/javascript");e.src=q;e.addEventListener?e.addEventListener("load",r,!1):e.onreadystatechange=function(){if("loaded"===e.readyState||"complete"===e.readyState)e.onreadystatechange=null,r()};c.appendChild(e);return a.promise}]).directive("googleChart",["$timeout",
    "$window","$rootScope","googleChartApiPromise",function(d,c,m,q){return{restrict:"A",scope:{beforeDraw:"&",chart:"=chart",onReady:"&",onSelect:"&",select:"&"},link:function(a,c,e){function h(b,c,d){if("undefined"!=typeof a.chart.formatters[b]){if(!l.equals(a.chart.formatters[b],a.oldChartFormatters[b]))if(a.oldChartFormatters[b]=a.chart.formatters[b],a.formatters[b]=[],"color"===b)for(var e=0;e<a.chart.formatters[b].length;e++){for(var h=new c,f=0;f<a.chart.formatters[b][e].formats.length;f++){var g=
        a.chart.formatters[b][e].formats[f];"undefined"!=typeof g.fromBgColor&&"undefined"!=typeof g.toBgColor?h.addGradientRange(g.from,g.to,g.color,g.fromBgColor,g.toBgColor):h.addRange(g.from,g.to,g.color,g.bgcolor)}a.formatters[b].push(h)}else for(var f=0;f<a.chart.formatters[b].length;f++)a.formatters[b].push(new c(a.chart.formatters[b][f]));for(f=0;f<a.formatters[b].length;f++)a.chart.formatters[b][f].columnNum<d.getNumberOfColumns()&&a.formatters[b][f].format(d,a.chart.formatters[b][f].columnNum);
        if("arrow"===b||"bar"===b||"color"===b)a.chart.options.allowHtml=!0}}function n(){n.triggered||void 0==a.chart||(n.triggered=!0,d(function(){"undefined"==typeof a.chartWrapper?(a.chartWrapper=new google.visualization.ChartWrapper({chartType:a.chart.type,dataTable:a.chart.data,view:a.chart.view,options:a.chart.options,containerId:c[0]}),google.visualization.events.addListener(a.chartWrapper,"ready",function(){a.chart.displayed=!0;a.$apply(function(a){a.onReady({chartWrapper:a.chartWrapper})})}),google.visualization.events.addListener(a.chartWrapper,
        "error",function(a){console.log("Chart not displayed due to error: "+a.message+". Full error object follows.");console.log(a)}),google.visualization.events.addListener(a.chartWrapper,"select",function(){var b=a.chartWrapper.getChart().getSelection()[0];a.$apply(function(){if(e.select)console.log("Angular-Google-Chart: The 'select' attribute is deprecated and will be removed in a future release.  Please use 'onSelect'."),a.select({selectedItem:b});else a.onSelect({selectedItem:b})})})):(a.chartWrapper.setChartType(a.chart.type),
        a.chartWrapper.setDataTable(a.chart.data),a.chartWrapper.setView(a.chart.view),a.chartWrapper.setOptions(a.chart.options));"undefined"===typeof a.formatters&&(a.formatters={});"undefined"!=typeof a.chart.formatters&&(h("number",google.visualization.NumberFormat,a.chartWrapper.getDataTable()),h("arrow",google.visualization.ArrowFormat,a.chartWrapper.getDataTable()),h("date",google.visualization.DateFormat,a.chartWrapper.getDataTable()),h("bar",google.visualization.BarFormat,a.chartWrapper.getDataTable()),
        h("color",google.visualization.ColorFormat,a.chartWrapper.getDataTable()));var b=a.chart.customFormatters;if("undefined"!=typeof b)for(var k in b)h(k,b[k],a.chartWrapper.getDataTable());d(function(){a.beforeDraw({chartWrapper:a.chartWrapper});a.chartWrapper.draw();n.triggered=!1})},0,!0))}function k(){q.then(function(){n()})}a.$watch(function(){return a.chart?{data:a.chart.data,formatters:a.chart.formatters,options:a.chart.options,type:a.chart.type,customFormatters:a.chart.customFormatters}:a.chart},
        function(){k()},!0);var p=m.$on("resizeMsg",function(){d(function(){a.chartWrapper&&k()})});a.$on("$destroy",function(){p()});a.oldChartFormatters={}}}}]).run(["$rootScope","$window",function(d,c){l.element(c).bind("resize",function(){d.$emit("resizeMsg")})}])})(document,window,window.angular);