{"version":3,"sources":["ng-file-upload.js"],"names":["patchXHR","fnName","newFn","window","XMLHttpRequest","prototype","redefineProp","xhr","prop","fn","Object","defineProperty","get","e","FileAPI","shouldLoad","FormData","forceLoad","initializeUploadListener","__listeners","upload","origAddEventListener","addEventListener","t","apply","this","arguments","orig","m","url","b","__url","message","indexOf","__origError","h","__fileApiXHR","getResponseHeader","getAllResponseHeaders","abort","header","value","val","Function","__requestHeaders","__isFileAPIShim","formData","config","jsonp","cache","complete","err","fileApiXHR","angular","isString","__completed","load","type","loaded","__loaded","total","__total","target","lengthComputable","loadend","undefined","status","statusText","response","resp","responseText","onreadystatechange","onload","progress","_this","setTimeout","noContentTimeout","headers","data","files","i","length","item","name","size","key","hasFlash","append","__isFileAPIBlobShim","push","Blob","isInputTypeFile","elem","tagName","toLowerCase","attr","fo","ActiveXObject","navigator","mimeTypes","getOffset","obj","left","top","jQuery","offset","offsetParent","offsetLeft","scrollLeft","offsetTop","scrollTop","html5","jsUrl","basePath","index","src","script","document","createElement","allScripts","getElementsByTagName","jsPath","search","substring","staticPath","setAttribute","appendChild","ngfFixIE","fileElem","changeFn","fixInputStyle","removeClass","unbind","bind","evt","fileApiChangeFn","addClass","css","offsetWidth","offsetHeight","getFiles","__files_","disableFileInput","disable","FileReader","loadStarted","listeners","removeEventListener","splice","dispatchEvent","list","call","onabort","onerror","onloadstart","onloadend","onprogress","constructEvent","error","result","listener","readAsArrayBuffer","file","readAsBinaryString","readAsDataURL","readAsText","setRequestHeader","ngFileUpload","module","version","service","$http","$q","$timeout","sendHttp","notifyProgress","deferred","notify","promise","progressFunc","getNotifyEvent","n","_start","resumeSupported","_file","uploadWithAngular","then","r","_chunkSize","_finished","_end","resolve","reject","method","_deferred","defer","disableProgress","__setXHR_","__XHR","xhrFn","resumeSizeUrl","resumeSizeResponseReader","parseInt","toString","resumeSize","success","pause","origXhrFn","isResumeSupported","slice","rename","ngfName","jsonBlob","blob","_ngfBlob","json","toJson","isFile","flashId","toResumeFile","Math","floor","addFieldToFormData","isDate","toISOString","split","replace","_fileKey","isObject","$$ngfCircularDetection","k","hasOwnProperty","objectKey","arrayKey","digestConfig","translateScalars","resumeChunkSize","transformRequest","isArray","fields","formDataAppender","_isDigested","http","ArrayBuffer","defaults","str","parseFloat","setDefaults","$parse","$compile","UploadResize","markModelAsDirty","ngModel","$dirty","$setDirty","resize","scope","callback","param","attrGetter","isResizeSupported","count","checkCallback","resizedFile","f","$error","$errorParam","width","height","quality","handleKeep","prevFiles","dupFiles","keep","hasNew","len","j","concat","getAttrWithDefaults","def","JSON","stringify","params","attrVal","shouldUpdateOn","modelOptions","updateOn","updateModel","fileChange","noDelay","update","invalidFiles","newFiles","isSingleModel","forEach","$ngfValidations","validation","$setValidity","valid","$setViewValue","$files","$file","$newFiles","$duplicateFiles","$invalidFiles","$event","invalidModel","assign","$modelValue","$$ngfPrevFiles","keepResult","validate","options","allowInvalid","valids","invalids","debounce","change","l","prevFile","URL","blobUrl","revokeObjectURL","directive","Upload","isDelayedClickSupported","ua","match","v","androidFixMinorVersion","test","linkFileSelect","fileChangeAttr","fileList","bindAttrToFileInput","attributes","attribute","createFileInput","element","generatedElems","el","ref","body","clickHandler","handleTouch","resetModel","userAgent","click","touches","changedTouches","originalEvent","initialTouchStartY","clientY","stopPropagation","preventDefault","currentLocation","abs","ie10SameFileSelectFix","parentNode","clone","replaceWith","removeAttr","unwatches","$watch","$observe","$$observers","accept","appVersion","$formatters","$on","remove","unwatch","g","contains","restrict","require","link","getTagType","linkFileDirective","directiveName","resizeParams","isBackground","constructDataUrl","disallowObjectUrl","dataUrl","$ngfDataUrl","$ngfBlobUrl","clientWidth","clientHeight","getComputedStyle","style","UploadBase","base64DataUrl","d","urls","ff","p","$$ngfDataUrlPromise","$$ngfBlobUrlPromise","webkitURL","createObjectURL","fileReader","UploadDataUrl","globStringToRegex","regexp","excludes","RegExp","validatePattern","pattern","exclude","later","validateSync","validatorVal","dName","toUpperCase","substr","validateAsync","asyncFn","thisPendings","hasError","pendings","$$ngfValidated","cons","min","max","imageDimensions","ratio","xIndex","duration","mediaDuration","$ngfWidth","$ngfHeight","$ngfDimensionPromise","img","checkLoadError","on","$ngfDuration","$ngfDurationPromise","UploadValidate","calculateAspectRatioFit","srcWidth","srcHeight","maxWidth","maxHeight","imagen","canvasElement","imagenElement","dimensions","context","getContext","drawImage","toDataURL","dataURLtoBlob","dataurl","arr","mime","bstr","atob","u8arr","Uint8Array","charCodeAt","linkDrop","$location","isDisabled","calculateDragOverClass","dClass","delay","dragOverDelay","items","dataTransfer","extractFiles","allowDir","multiple","traverseFileTree","entry","path","isDirectory","filePath","dirReader","createReader","entries","processing","readEntries","results","Array","console","protocol","webkitGetAsEntry","getAsFile","delays","waitForProcess","available","dropAvailable","actualDragOverClass","leaveTimeout","effectAllowed","dropEffect","cancel","clazz","$isDragging","$class","html","getData","responseType","arrayBufferView","clipboard","clipboardData","div","model"],"mappings":"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","file":"ng-file-upload.min.js","sourcesContent":["/**!\n * AngularJS file upload directives and services. Supoorts: file upload/drop/paste, resume, cancel/abort,\n * progress, resize, thumbnail, preview, validation and CORS\n * FileAPI Flash shim for old browsers not supporting FormData\n * @author  Danial  <danial.farid@gmail.com>\n * @version 9.0.7\n */\n\n(function () {\n    /** @namespace FileAPI.noContentTimeout */\n\n    function patchXHR(fnName, newFn) {\n        window.XMLHttpRequest.prototype[fnName] = newFn(window.XMLHttpRequest.prototype[fnName]);\n    }\n\n    function redefineProp(xhr, prop, fn) {\n        try {\n            Object.defineProperty(xhr, prop, {get: fn});\n        } catch (e) {/*ignore*/\n        }\n    }\n\n    if (!window.FileAPI) {\n        window.FileAPI = {};\n    }\n\n    if (!window.XMLHttpRequest) {\n        throw 'AJAX is not supported. XMLHttpRequest is not defined.';\n    }\n\n    FileAPI.shouldLoad = !window.FormData || FileAPI.forceLoad;\n    if (FileAPI.shouldLoad) {\n        var initializeUploadListener = function (xhr) {\n            if (!xhr.__listeners) {\n                if (!xhr.upload) xhr.upload = {};\n                xhr.__listeners = [];\n                var origAddEventListener = xhr.upload.addEventListener;\n                xhr.upload.addEventListener = function (t, fn) {\n                    xhr.__listeners[t] = fn;\n                    if (origAddEventListener) origAddEventListener.apply(this, arguments);\n                };\n            }\n        };\n\n        patchXHR('open', function (orig) {\n            return function (m, url, b) {\n                initializeUploadListener(this);\n                this.__url = url;\n                try {\n                    orig.apply(this, [m, url, b]);\n                } catch (e) {\n                    if (e.message.indexOf('Access is denied') > -1) {\n                        this.__origError = e;\n                        orig.apply(this, [m, '_fix_for_ie_crossdomain__', b]);\n                    }\n                }\n            };\n        });\n\n        patchXHR('getResponseHeader', function (orig) {\n            return function (h) {\n                return this.__fileApiXHR && this.__fileApiXHR.getResponseHeader ? this.__fileApiXHR.getResponseHeader(h) : (orig == null ? null : orig.apply(this, [h]));\n            };\n        });\n\n        patchXHR('getAllResponseHeaders', function (orig) {\n            return function () {\n                return this.__fileApiXHR && this.__fileApiXHR.getAllResponseHeaders ? this.__fileApiXHR.getAllResponseHeaders() : (orig == null ? null : orig.apply(this));\n            };\n        });\n\n        patchXHR('abort', function (orig) {\n            return function () {\n                return this.__fileApiXHR && this.__fileApiXHR.abort ? this.__fileApiXHR.abort() : (orig == null ? null : orig.apply(this));\n            };\n        });\n\n        patchXHR('setRequestHeader', function (orig) {\n            return function (header, value) {\n                if (header === '__setXHR_') {\n                    initializeUploadListener(this);\n                    var val = value(this);\n                    // fix for angular < 1.2.0\n                    if (val instanceof Function) {\n                        val(this);\n                    }\n                } else {\n                    this.__requestHeaders = this.__requestHeaders || {};\n                    this.__requestHeaders[header] = value;\n                    orig.apply(this, arguments);\n                }\n            };\n        });\n\n        patchXHR('send', function (orig) {\n            return function () {\n                var xhr = this;\n                if (arguments[0] && arguments[0].__isFileAPIShim) {\n                    var formData = arguments[0];\n                    var config = {\n                        url: xhr.__url,\n                        jsonp: false, //removes the callback form param\n                        cache: true, //removes the ?fileapiXXX in the url\n                        complete: function (err, fileApiXHR) {\n                            if (err && angular.isString(err) && err.indexOf('#2174') !== -1) {\n                                // this error seems to be fine the file is being uploaded properly.\n                                err = null;\n                            }\n                            xhr.__completed = true;\n                            if (!err && xhr.__listeners.load)\n                                xhr.__listeners.load({\n                                    type: 'load',\n                                    loaded: xhr.__loaded,\n                                    total: xhr.__total,\n                                    target: xhr,\n                                    lengthComputable: true\n                                });\n                            if (!err && xhr.__listeners.loadend)\n                                xhr.__listeners.loadend({\n                                    type: 'loadend',\n                                    loaded: xhr.__loaded,\n                                    total: xhr.__total,\n                                    target: xhr,\n                                    lengthComputable: true\n                                });\n                            if (err === 'abort' && xhr.__listeners.abort)\n                                xhr.__listeners.abort({\n                                    type: 'abort',\n                                    loaded: xhr.__loaded,\n                                    total: xhr.__total,\n                                    target: xhr,\n                                    lengthComputable: true\n                                });\n                            if (fileApiXHR.status !== undefined) redefineProp(xhr, 'status', function () {\n                                return (fileApiXHR.status === 0 && err && err !== 'abort') ? 500 : fileApiXHR.status;\n                            });\n                            if (fileApiXHR.statusText !== undefined) redefineProp(xhr, 'statusText', function () {\n                                return fileApiXHR.statusText;\n                            });\n                            redefineProp(xhr, 'readyState', function () {\n                                return 4;\n                            });\n                            if (fileApiXHR.response !== undefined) redefineProp(xhr, 'response', function () {\n                                return fileApiXHR.response;\n                            });\n                            var resp = fileApiXHR.responseText || (err && fileApiXHR.status === 0 && err !== 'abort' ? err : undefined);\n                            redefineProp(xhr, 'responseText', function () {\n                                return resp;\n                            });\n                            redefineProp(xhr, 'response', function () {\n                                return resp;\n                            });\n                            if (err) redefineProp(xhr, 'err', function () {\n                                return err;\n                            });\n                            xhr.__fileApiXHR = fileApiXHR;\n                            if (xhr.onreadystatechange) xhr.onreadystatechange();\n                            if (xhr.onload) xhr.onload();\n                        },\n                        progress: function (e) {\n                            e.target = xhr;\n                            if (xhr.__listeners.progress) xhr.__listeners.progress(e);\n                            xhr.__total = e.total;\n                            xhr.__loaded = e.loaded;\n                            if (e.total === e.loaded) {\n                                // fix flash issue that doesn't call complete if there is no response text from the server\n                                var _this = this;\n                                setTimeout(function () {\n                                    if (!xhr.__completed) {\n                                        xhr.getAllResponseHeaders = function () {\n                                        };\n                                        _this.complete(null, {status: 204, statusText: 'No Content'});\n                                    }\n                                }, FileAPI.noContentTimeout || 10000);\n                            }\n                        },\n                        headers: xhr.__requestHeaders\n                    };\n                    config.data = {};\n                    config.files = {};\n                    for (var i = 0; i < formData.data.length; i++) {\n                        var item = formData.data[i];\n                        if (item.val != null && item.val.name != null && item.val.size != null && item.val.type != null) {\n                            config.files[item.key] = item.val;\n                        } else {\n                            config.data[item.key] = item.val;\n                        }\n                    }\n\n                    setTimeout(function () {\n                        if (!FileAPI.hasFlash) {\n                            throw 'Adode Flash Player need to be installed. To check ahead use \"FileAPI.hasFlash\"';\n                        }\n                        xhr.__fileApiXHR = FileAPI.upload(config);\n                    }, 1);\n                } else {\n                    if (this.__origError) {\n                        throw this.__origError;\n                    }\n                    orig.apply(xhr, arguments);\n                }\n            };\n        });\n        window.XMLHttpRequest.__isFileAPIShim = true;\n        window.FormData = FormData = function () {\n            return {\n                append: function (key, val, name) {\n                    if (val.__isFileAPIBlobShim) {\n                        val = val.data[0];\n                    }\n                    this.data.push({\n                        key: key,\n                        val: val,\n                        name: name\n                    });\n                },\n                data: [],\n                __isFileAPIShim: true\n            };\n        };\n\n        window.Blob = Blob = function (b) {\n            return {\n                data: b,\n                __isFileAPIBlobShim: true\n            };\n        };\n    }\n\n})();\n\n(function () {\n    /** @namespace FileAPI.forceLoad */\n    /** @namespace window.FileAPI.jsUrl */\n    /** @namespace window.FileAPI.jsPath */\n\n    function isInputTypeFile(elem) {\n        return elem[0].tagName.toLowerCase() === 'input' && elem.attr('type') && elem.attr('type').toLowerCase() === 'file';\n    }\n\n    function hasFlash() {\n        try {\n            var fo = new ActiveXObject('ShockwaveFlash.ShockwaveFlash');\n            if (fo) return true;\n        } catch (e) {\n            if (navigator.mimeTypes['application/x-shockwave-flash'] !== undefined) return true;\n        }\n        return false;\n    }\n\n    function getOffset(obj) {\n        var left = 0, top = 0;\n\n        if (window.jQuery) {\n            return jQuery(obj).offset();\n        }\n\n        if (obj.offsetParent) {\n            do {\n                left += (obj.offsetLeft - obj.scrollLeft);\n                top += (obj.offsetTop - obj.scrollTop);\n                obj = obj.offsetParent;\n            } while (obj);\n        }\n        return {\n            left: left,\n            top: top\n        };\n    }\n\n    if (FileAPI.shouldLoad) {\n        FileAPI.hasFlash = hasFlash();\n\n        //load FileAPI\n        if (FileAPI.forceLoad) {\n            FileAPI.html5 = false;\n        }\n\n        if (!FileAPI.upload) {\n            var jsUrl, basePath, script = document.createElement('script'), allScripts = document.getElementsByTagName('script'), i, index, src;\n            if (window.FileAPI.jsUrl) {\n                jsUrl = window.FileAPI.jsUrl;\n            } else if (window.FileAPI.jsPath) {\n                basePath = window.FileAPI.jsPath;\n            } else {\n                for (i = 0; i < allScripts.length; i++) {\n                    src = allScripts[i].src;\n                    index = src.search(/\\/ng\\-file\\-upload[\\-a-zA-z0-9\\.]*\\.js/);\n                    if (index > -1) {\n                        basePath = src.substring(0, index + 1);\n                        break;\n                    }\n                }\n            }\n\n            if (FileAPI.staticPath == null) FileAPI.staticPath = basePath;\n            script.setAttribute('src', jsUrl || basePath + 'FileAPI.min.js');\n            document.getElementsByTagName('head')[0].appendChild(script);\n        }\n\n        FileAPI.ngfFixIE = function (elem, fileElem, changeFn) {\n            if (!hasFlash()) {\n                throw 'Adode Flash Player need to be installed. To check ahead use \"FileAPI.hasFlash\"';\n            }\n            var fixInputStyle = function () {\n                if (elem.attr('disabled')) {\n                    if (fileElem) fileElem.removeClass('js-fileapi-wrapper');\n                } else {\n                    if (!fileElem.attr('__ngf_flash_')) {\n                        fileElem.unbind('change');\n                        fileElem.unbind('click');\n                        fileElem.bind('change', function (evt) {\n                            fileApiChangeFn.apply(this, [evt]);\n                            changeFn.apply(this, [evt]);\n                        });\n                        fileElem.attr('__ngf_flash_', 'true');\n                    }\n                    fileElem.addClass('js-fileapi-wrapper');\n                    if (!isInputTypeFile(elem)) {\n                        fileElem.css('position', 'absolute')\n                            .css('top', getOffset(elem[0]).top + 'px').css('left', getOffset(elem[0]).left + 'px')\n                            .css('width', elem[0].offsetWidth + 'px').css('height', elem[0].offsetHeight + 'px')\n                            .css('filter', 'alpha(opacity=0)').css('display', elem.css('display'))\n                            .css('overflow', 'hidden').css('z-index', '900000')\n                            .css('visibility', 'visible');\n                    }\n                }\n            };\n\n            elem.bind('mouseenter', fixInputStyle);\n\n            var fileApiChangeFn = function (evt) {\n                var files = FileAPI.getFiles(evt);\n                //just a double check for #233\n                for (var i = 0; i < files.length; i++) {\n                    if (files[i].size === undefined) files[i].size = 0;\n                    if (files[i].name === undefined) files[i].name = 'file';\n                    if (files[i].type === undefined) files[i].type = 'undefined';\n                }\n                if (!evt.target) {\n                    evt.target = {};\n                }\n                evt.target.files = files;\n                // if evt.target.files is not writable use helper field\n                if (evt.target.files !== files) {\n                    evt.__files_ = files;\n                }\n                (evt.__files_ || evt.target.files).item = function (i) {\n                    return (evt.__files_ || evt.target.files)[i] || null;\n                };\n            };\n        };\n\n        FileAPI.disableFileInput = function (elem, disable) {\n            if (disable) {\n                elem.removeClass('js-fileapi-wrapper');\n            } else {\n                elem.addClass('js-fileapi-wrapper');\n            }\n        };\n    }\n})();\n\nif (!window.FileReader) {\n    window.FileReader = function () {\n        var _this = this, loadStarted = false;\n        this.listeners = {};\n        this.addEventListener = function (type, fn) {\n            _this.listeners[type] = _this.listeners[type] || [];\n            _this.listeners[type].push(fn);\n        };\n        this.removeEventListener = function (type, fn) {\n            if (_this.listeners[type]) _this.listeners[type].splice(_this.listeners[type].indexOf(fn), 1);\n        };\n        this.dispatchEvent = function (evt) {\n            var list = _this.listeners[evt.type];\n            if (list) {\n                for (var i = 0; i < list.length; i++) {\n                    list[i].call(_this, evt);\n                }\n            }\n        };\n        this.onabort = this.onerror = this.onload = this.onloadstart = this.onloadend = this.onprogress = null;\n\n        var constructEvent = function (type, evt) {\n            var e = {type: type, target: _this, loaded: evt.loaded, total: evt.total, error: evt.error};\n            if (evt.result != null) e.target.result = evt.result;\n            return e;\n        };\n        var listener = function (evt) {\n            if (!loadStarted) {\n                loadStarted = true;\n                if (_this.onloadstart) _this.onloadstart(constructEvent('loadstart', evt));\n            }\n            var e;\n            if (evt.type === 'load') {\n                if (_this.onloadend) _this.onloadend(constructEvent('loadend', evt));\n                e = constructEvent('load', evt);\n                if (_this.onload) _this.onload(e);\n                _this.dispatchEvent(e);\n            } else if (evt.type === 'progress') {\n                e = constructEvent('progress', evt);\n                if (_this.onprogress) _this.onprogress(e);\n                _this.dispatchEvent(e);\n            } else {\n                e = constructEvent('error', evt);\n                if (_this.onerror) _this.onerror(e);\n                _this.dispatchEvent(e);\n            }\n        };\n        this.readAsArrayBuffer = function (file) {\n            FileAPI.readAsBinaryString(file, listener);\n        };\n        this.readAsBinaryString = function (file) {\n            FileAPI.readAsBinaryString(file, listener);\n        };\n        this.readAsDataURL = function (file) {\n            FileAPI.readAsDataURL(file, listener);\n        };\n        this.readAsText = function (file) {\n            FileAPI.readAsText(file, listener);\n        };\n    };\n}\n\n/**!\n * AngularJS file upload directives and services. Supoorts: file upload/drop/paste, resume, cancel/abort,\n * progress, resize, thumbnail, preview, validation and CORS\n * @author  Danial  <danial.farid@gmail.com>\n * @version 9.0.7\n */\n\nif (window.XMLHttpRequest && !(window.FileAPI && FileAPI.shouldLoad)) {\n    window.XMLHttpRequest.prototype.setRequestHeader = (function (orig) {\n        return function (header, value) {\n            if (header === '__setXHR_') {\n                var val = value(this);\n                // fix for angular < 1.2.0\n                if (val instanceof Function) {\n                    val(this);\n                }\n            } else {\n                orig.apply(this, arguments);\n            }\n        };\n    })(window.XMLHttpRequest.prototype.setRequestHeader);\n}\n\nvar ngFileUpload = angular.module('ngFileUpload', []);\n\nngFileUpload.version = '9.0.7';\n\nngFileUpload.service('UploadBase', ['$http', '$q', '$timeout', function ($http, $q, $timeout) {\n    var upload = this;\n\n    this.isResumeSupported = function () {\n        return window.Blob && (Blob instanceof Function) && new Blob().slice;\n    };\n\n    var resumeSupported = this.isResumeSupported();\n\n    function sendHttp(config) {\n        config.method = config.method || 'POST';\n        config.headers = config.headers || {};\n\n        var deferred = config._deferred = config._deferred || $q.defer();\n        var promise = deferred.promise;\n\n        function notifyProgress(e) {\n            if (deferred.notify) {\n                deferred.notify(e);\n            }\n            if (promise.progressFunc) {\n                $timeout(function () {\n                    promise.progressFunc(e);\n                });\n            }\n        }\n\n        function getNotifyEvent(n) {\n            if (config._start != null && resumeSupported) {\n                return {\n                    loaded: n.loaded + config._start, total: config._file.size, type: n.type, config: config,\n                    lengthComputable: true, target: n.target\n                };\n            } else {\n                return n;\n            }\n        }\n\n        if (!config.disableProgress) {\n            config.headers.__setXHR_ = function () {\n                return function (xhr) {\n                    if (!xhr || !(xhr instanceof XMLHttpRequest)) return;\n                    config.__XHR = xhr;\n                    if (config.xhrFn) config.xhrFn(xhr);\n                    xhr.upload.addEventListener('progress', function (e) {\n                        e.config = config;\n                        notifyProgress(getNotifyEvent(e));\n                    }, false);\n                    //fix for firefox not firing upload progress end, also IE8-9\n                    xhr.upload.addEventListener('load', function (e) {\n                        if (e.lengthComputable) {\n                            e.config = config;\n                            notifyProgress(getNotifyEvent(e));\n                        }\n                    }, false);\n                };\n            };\n        }\n\n        function uploadWithAngular() {\n            $http(config).then(function (r) {\n                if (resumeSupported && config._chunkSize && !config._finished) {\n                    notifyProgress({loaded: config._end, total: config._file.size, config: config, type: 'progress'});\n                    upload.upload(config);\n                } else {\n                    if (config._finished) delete config._finished;\n                    deferred.resolve(r);\n                }\n            }, function (e) {\n                deferred.reject(e);\n            }, function (n) {\n                deferred.notify(n);\n            });\n        }\n\n        if (!resumeSupported) {\n            uploadWithAngular();\n        } else if (config._chunkSize && config._end && !config._finished) {\n            config._start = config._end;\n            config._end += config._chunkSize;\n            uploadWithAngular();\n        } else if (config.resumeSizeUrl) {\n            $http.get(config.resumeSizeUrl).then(function (resp) {\n                if (config.resumeSizeResponseReader) {\n                    config._start = config.resumeSizeResponseReader(resp.data);\n                } else {\n                    config._start = parseInt((resp.data.size == null ? resp.data : resp.data.size).toString());\n                }\n                if (config._chunkSize) {\n                    config._end = config._start + config._chunkSize;\n                }\n                uploadWithAngular();\n            }, function (e) {\n                throw e;\n            });\n        } else if (config.resumeSize) {\n            config.resumeSize().then(function (size) {\n                config._start = size;\n                uploadWithAngular();\n            }, function (e) {\n                throw e;\n            });\n        } else {\n            uploadWithAngular();\n        }\n\n\n        promise.success = function (fn) {\n            promise.then(function (response) {\n                fn(response.data, response.status, response.headers, config);\n            });\n            return promise;\n        };\n\n        promise.error = function (fn) {\n            promise.then(null, function (response) {\n                fn(response.data, response.status, response.headers, config);\n            });\n            return promise;\n        };\n\n        promise.progress = function (fn) {\n            promise.progressFunc = fn;\n            promise.then(null, null, function (n) {\n                fn(n);\n            });\n            return promise;\n        };\n        promise.abort = promise.pause = function () {\n            if (config.__XHR) {\n                $timeout(function () {\n                    config.__XHR.abort();\n                });\n            }\n            return promise;\n        };\n        promise.xhr = function (fn) {\n            config.xhrFn = (function (origXhrFn) {\n                return function () {\n                    if (origXhrFn) origXhrFn.apply(promise, arguments);\n                    fn.apply(promise, arguments);\n                };\n            })(config.xhrFn);\n            return promise;\n        };\n\n        return promise;\n    }\n\n    this.rename = function (file, name) {\n        file.ngfName = name;\n        return file;\n    };\n\n    this.jsonBlob = function (val) {\n        var blob = new Blob([val], {type: 'application/json'});\n        blob._ngfBlob = true;\n        return blob;\n    };\n\n    this.json = function (val) {\n        return angular.toJson(val);\n    };\n\n    this.upload = function (config) {\n        function isFile(file) {\n            return file != null && file instanceof Blob || (file.flashId && file.name && file.size);\n        }\n\n        function toResumeFile(file, formData) {\n            if (file._ngfBlob) return file;\n            config._file = config._file || file;\n            if (config._start != null && resumeSupported) {\n                if (config._end && config._end >= file.size) {\n                    config._finished = true;\n                    config._end = file.size;\n                }\n                var slice = file.slice(config._start, config._end || file.size);\n                slice.name = file.name;\n                slice.ngfName = file.ngfName;\n                if (config._chunkSize) {\n                    formData.append('_chunkSize', config._end - config._start);\n                    formData.append('_chunkNumber', Math.floor(config._start / config._chunkSize));\n                    formData.append('_totalSize', config._file.size);\n                }\n                return slice;\n            }\n            return file;\n        }\n\n        function addFieldToFormData(formData, val, key) {\n            if (val !== undefined) {\n                if (angular.isDate(val)) {\n                    val = val.toISOString();\n                }\n                if (angular.isString(val)) {\n                    formData.append(key, val);\n                } else if (isFile(val)) {\n                    var file = toResumeFile(val, formData);\n                    var split = key.split(',');\n                    if (split[1]) {\n                        file.ngfName = split[1].replace(/^\\s+|\\s+$/g, '');\n                        key = split[0];\n                    }\n                    config._fileKey = config._fileKey || key;\n                    formData.append(key, file, file.ngfName || file.name);\n                } else {\n                    if (angular.isObject(val)) {\n                        if (val.$$ngfCircularDetection) throw 'ngFileUpload: Circular reference in config.data. Make sure specified data for Upload.upload() has no circular reference: ' + key;\n\n                        val.$$ngfCircularDetection = true;\n                        try {\n                            for (var k in val) {\n                                if (val.hasOwnProperty(k) && k !== '$$ngfCircularDetection') {\n                                    var objectKey = config.objectKey == null ? '[i]' : config.objectKey;\n                                    if (val.length && parseInt(k) > -1) {\n                                        objectKey = config.arrayKey == null ? objectKey : config.arrayKey;\n                                    }\n                                    addFieldToFormData(formData, val[k], key + objectKey.replace(/[ik]/g, k));\n                                }\n                            }\n                        } finally {\n                            delete val.$$ngfCircularDetection;\n                        }\n                    } else {\n                        formData.append(key, val);\n                    }\n                }\n            }\n        }\n\n        function digestConfig() {\n            config._chunkSize = upload.translateScalars(config.resumeChunkSize);\n            config._chunkSize = config._chunkSize ? parseInt(config._chunkSize.toString()) : null;\n\n            config.headers = config.headers || {};\n            config.headers['Content-Type'] = undefined;\n            config.transformRequest = config.transformRequest ?\n                (angular.isArray(config.transformRequest) ?\n                    config.transformRequest : [config.transformRequest]) : [];\n            config.transformRequest.push(function (data) {\n                var formData = new FormData(), key;\n                data = data || config.fields || {};\n                if (config.file) {\n                    data.file = config.file;\n                }\n                for (key in data) {\n                    if (data.hasOwnProperty(key)) {\n                        var val = data[key];\n                        if (config.formDataAppender) {\n                            config.formDataAppender(formData, key, val);\n                        } else {\n                            addFieldToFormData(formData, val, key);\n                        }\n                    }\n                }\n\n                return formData;\n            });\n        }\n\n        if (!config._isDigested) {\n            config._isDigested = true;\n            digestConfig();\n        }\n\n        return sendHttp(config);\n    };\n\n    this.http = function (config) {\n        config.transformRequest = config.transformRequest || function (data) {\n                if ((window.ArrayBuffer && data instanceof window.ArrayBuffer) || data instanceof Blob) {\n                    return data;\n                }\n                return $http.defaults.transformRequest[0].apply(this, arguments);\n            };\n        config._chunkSize = upload.translateScalars(config.resumeChunkSize);\n        config._chunkSize = config._chunkSize ? parseInt(config._chunkSize.toString()) : null;\n\n        return sendHttp(config);\n    };\n\n    this.translateScalars = function (str) {\n        if (angular.isString(str)) {\n            if (str.search(/kb/i) === str.length - 2) {\n                return parseFloat(str.substring(0, str.length - 2) * 1000);\n            } else if (str.search(/mb/i) === str.length - 2) {\n                return parseFloat(str.substring(0, str.length - 2) * 1000000);\n            } else if (str.search(/gb/i) === str.length - 2) {\n                return parseFloat(str.substring(0, str.length - 2) * 1000000000);\n            } else if (str.search(/b/i) === str.length - 1) {\n                return parseFloat(str.substring(0, str.length - 1));\n            } else if (str.search(/s/i) === str.length - 1) {\n                return parseFloat(str.substring(0, str.length - 1));\n            } else if (str.search(/m/i) === str.length - 1) {\n                return parseFloat(str.substring(0, str.length - 1) * 60);\n            } else if (str.search(/h/i) === str.length - 1) {\n                return parseFloat(str.substring(0, str.length - 1) * 3600);\n            }\n        }\n        return str;\n    };\n\n    this.setDefaults = function (defaults) {\n        this.defaults = defaults || {};\n    };\n\n    this.defaults = {};\n    this.version = ngFileUpload.version;\n}\n\n]);\n\nngFileUpload.service('Upload', ['$parse', '$timeout', '$compile', 'UploadResize', function ($parse, $timeout, $compile, UploadResize) {\n    var upload = UploadResize;\n    upload.getAttrWithDefaults = function (attr, name) {\n        if (attr[name] != null) return attr[name];\n        var def = upload.defaults[name];\n        return (def == null ? def : (angular.isString(def) ? def : JSON.stringify(def)));\n    };\n\n    upload.attrGetter = function (name, attr, scope, params) {\n        var attrVal = this.getAttrWithDefaults(attr, name);\n        if (scope) {\n            try {\n                if (params) {\n                    return $parse(attrVal)(scope, params);\n                } else {\n                    return $parse(attrVal)(scope);\n                }\n            } catch (e) {\n                // hangle string value without single qoute\n                if (name.search(/min|max|pattern/i)) {\n                    return attrVal;\n                } else {\n                    throw e;\n                }\n            }\n        } else {\n            return attrVal;\n        }\n    };\n\n    upload.shouldUpdateOn = function (type, attr, scope) {\n        var modelOptions = upload.attrGetter('ngModelOptions', attr, scope);\n        if (modelOptions && modelOptions.updateOn) {\n            return modelOptions.updateOn.split(' ').indexOf(type) > -1;\n        }\n        return true;\n    };\n\n    function markModelAsDirty(ngModel, files) {\n        if (files != null && !ngModel.$dirty) {\n            if (ngModel.$setDirty) {\n                ngModel.$setDirty();\n            } else {\n                ngModel.$dirty = true;\n            }\n        }\n    }\n\n    function resize(files, attr, scope, callback) {\n        var param = upload.attrGetter('ngfResize', attr, scope);\n        if (!param || !upload.isResizeSupported()) return callback();\n        var count = files.length;\n        var checkCallback = function () {\n            count--;\n            if (count === 0) callback();\n        };\n        var success = function (index) {\n            return function (resizedFile) {\n                files.splice(index, 1, resizedFile);\n                checkCallback();\n            };\n        };\n        var error = function (f) {\n            return function (e) {\n                checkCallback();\n                f.$error = 'resize';\n                f.$errorParam = (e ? (e.message ? e.message : e) + ': ' : '') + (f && f.name);\n            };\n        };\n        for (var i = 0; i < files.length; i++) {\n            var f = files[i];\n            if (f.type.indexOf('image') === 0) {\n                upload.resize(f, param.width, param.height, param.quality).then(success(i), error(f));\n            } else {\n                checkCallback();\n            }\n        }\n    }\n\n    function handleKeep(files, prevFiles, attr, scope) {\n        var dupFiles = [];\n        var keep = upload.attrGetter('ngfKeep', attr, scope);\n        if (keep) {\n            var hasNew = false;\n\n            if (keep === 'distinct' || upload.attrGetter('ngfKeepDistinct', attr, scope) === true) {\n                var len = prevFiles.length;\n                if (files) {\n                    for (var i = 0; i < files.length; i++) {\n                        for (var j = 0; j < len; j++) {\n                            if (files[i].name === prevFiles[j].name) {\n                                dupFiles.push(files[i]);\n                                break;\n                            }\n                        }\n                        if (j === len) {\n                            prevFiles.push(files[i]);\n                            hasNew = true;\n                        }\n                    }\n                }\n                files = prevFiles;\n            } else {\n                files = prevFiles.concat(files || []);\n            }\n        }\n        return {files: files, dupFiles: dupFiles, keep: keep};\n    }\n\n    upload.updateModel = function (ngModel, attr, scope, fileChange, files, evt, noDelay) {\n        function update(files, invalidFiles, newFiles, dupFiles, isSingleModel) {\n            var file = files && files.length ? files[0] : null;\n\n            if (ngModel) {\n                markModelAsDirty(ngModel, files);\n\n                angular.forEach(ngModel.$ngfValidations, function (validation) {\n                    ngModel.$setValidity(validation.name, validation.valid);\n                });\n\n                if (ngModel) {\n                    ngModel.$setViewValue(isSingleModel ? file : files);\n                }\n            }\n\n            if (fileChange) {\n                $parse(fileChange)(scope, {\n                    $files: files,\n                    $file: file,\n                    $newFiles: newFiles,\n                    $duplicateFiles: dupFiles,\n                    $invalidFiles: invalidFiles,\n                    $event: evt\n                });\n            }\n\n            var invalidModel = upload.attrGetter('ngfModelInvalid', attr);\n            if (invalidModel) {\n                $timeout(function () {\n                    $parse(invalidModel).assign(scope, invalidFiles);\n                });\n            }\n            $timeout(function () {\n                // scope apply changes\n            });\n        }\n\n        var newFiles = files;\n        var prevFiles = ((ngModel && ngModel.$modelValue) || attr.$$ngfPrevFiles || []).slice(0);\n        var keepResult = handleKeep(files, prevFiles, attr, scope);\n        files = keepResult.files;\n        var dupFiles = keepResult.dupFiles;\n        var isSingleModel = !upload.attrGetter('ngfMultiple', attr, scope) && !upload.attrGetter('multiple', attr) && !keepResult.keep;\n\n        attr.$$ngfPrevFiles = files;\n\n        if (upload.validate(newFiles, ngModel, attr, scope, upload.attrGetter('ngfValidateLater', attr), function () {\n                if (noDelay) {\n                    update(files, [], newFiles, dupFiles, isSingleModel);\n                } else {\n                    var options = upload.attrGetter('ngModelOptions', attr, scope);\n                    if (!options || !options.allowInvalid) {\n                        var valids = [], invalids = [];\n                        angular.forEach(files, function (file) {\n                            if (file.$error) {\n                                invalids.push(file);\n                            } else {\n                                valids.push(file);\n                            }\n                        });\n                        files = valids;\n                    }\n                    resize(files, attr, scope, function () {\n                        $timeout(function () {\n                            update(files, invalids, newFiles, dupFiles, isSingleModel);\n                        }, options && options.debounce ? options.debounce.change || options.debounce : 0);\n                    });\n                }\n            }));\n\n        // cleaning object url memories\n        var l = prevFiles.length;\n        while (l--) {\n            var prevFile = prevFiles[l];\n            if (window.URL && prevFile.blobUrl) {\n                URL.revokeObjectURL(prevFile.blobUrl);\n                delete prevFile.blobUrl;\n            }\n        }\n    };\n\n    return upload;\n}]);\n\nngFileUpload.directive('ngfSelect', ['$parse', '$timeout', '$compile', 'Upload', function ($parse, $timeout, $compile, Upload) {\n    var generatedElems = [];\n\n    function isDelayedClickSupported(ua) {\n        // fix for android native browser < 4.4 and safari windows\n        var m = ua.match(/Android[^\\d]*(\\d+)\\.(\\d+)/);\n        if (m && m.length > 2) {\n            var v = Upload.defaults.androidFixMinorVersion || 4;\n            return parseInt(m[1]) < 4 || (parseInt(m[1]) === v && parseInt(m[2]) < v);\n        }\n\n        // safari on windows\n        return ua.indexOf('Chrome') === -1 && /.*Windows.*Safari.*/.test(ua);\n    }\n\n    function linkFileSelect(scope, elem, attr, ngModel, $parse, $timeout, $compile, upload) {\n        /** @namespace attr.ngfSelect */\n        /** @namespace attr.ngfChange */\n        /** @namespace attr.ngModel */\n        /** @namespace attr.ngModelOptions */\n        /** @namespace attr.ngfMultiple */\n        /** @namespace attr.ngfCapture */\n        /** @namespace attr.ngfValidate */\n        /** @namespace attr.ngfKeep */\n        var attrGetter = function (name, scope) {\n            return upload.attrGetter(name, attr, scope);\n        };\n\n        function isInputTypeFile() {\n            return elem[0].tagName.toLowerCase() === 'input' && attr.type && attr.type.toLowerCase() === 'file';\n        }\n\n        function fileChangeAttr() {\n            return attrGetter('ngfChange') || attrGetter('ngfSelect');\n        }\n\n        function changeFn(evt) {\n            if (upload.shouldUpdateOn('change', attr, scope)) {\n                var fileList = evt.__files_ || (evt.target && evt.target.files), files = [];\n                for (var i = 0; i < fileList.length; i++) {\n                    files.push(fileList[i]);\n                }\n                upload.updateModel(ngModel, attr, scope, fileChangeAttr(),\n                    files.length ? files : null, evt);\n            }\n        }\n\n        var unwatches = [];\n        unwatches.push(scope.$watch(attrGetter('ngfMultiple'), function () {\n            fileElem.attr('multiple', attrGetter('ngfMultiple', scope));\n        }));\n        unwatches.push(scope.$watch(attrGetter('ngfCapture'), function () {\n            fileElem.attr('capture', attrGetter('ngfCapture', scope));\n        }));\n        attr.$observe('accept', function () {\n            fileElem.attr('accept', attrGetter('accept'));\n        });\n        unwatches.push(function () {\n            if (attr.$$observers) delete attr.$$observers.accept;\n        });\n        function bindAttrToFileInput(fileElem) {\n            if (elem !== fileElem) {\n                for (var i = 0; i < elem[0].attributes.length; i++) {\n                    var attribute = elem[0].attributes[i];\n                    if (attribute.name !== 'type' && attribute.name !== 'class' &&\n                        attribute.name !== 'id' && attribute.name !== 'style') {\n                        if (attribute.value == null || attribute.value === '') {\n                            if (attribute.name === 'required') attribute.value = 'required';\n                            if (attribute.name === 'multiple') attribute.value = 'multiple';\n                        }\n                        fileElem.attr(attribute.name, attribute.value);\n                    }\n                }\n            }\n        }\n\n        function createFileInput() {\n            if (isInputTypeFile()) {\n                return elem;\n            }\n\n            var fileElem = angular.element('<input type=\"file\">');\n            bindAttrToFileInput(fileElem);\n\n            fileElem.css('visibility', 'hidden').css('position', 'absolute').css('overflow', 'hidden')\n                .css('width', '0px').css('height', '0px').css('border', 'none')\n                .css('margin', '0px').css('padding', '0px').attr('tabindex', '-1');\n            generatedElems.push({el: elem, ref: fileElem});\n            document.body.appendChild(fileElem[0]);\n\n            return fileElem;\n        }\n\n        var initialTouchStartY = 0;\n\n        function clickHandler(evt) {\n            if (elem.attr('disabled') || attrGetter('ngfSelectDisabled', scope)) return false;\n\n            var r = handleTouch(evt);\n            if (r != null) return r;\n\n            resetModel(evt);\n\n            if (isDelayedClickSupported(navigator.userAgent)) {\n                setTimeout(function () {\n                    fileElem[0].click();\n                }, 0);\n            } else {\n                fileElem[0].click();\n            }\n\n            return false;\n        }\n\n        function handleTouch(evt) {\n            var touches = evt.changedTouches || (evt.originalEvent && evt.originalEvent.changedTouches);\n            if (evt.type === 'touchstart') {\n                initialTouchStartY = touches ? touches[0].clientY : 0;\n                return true; // don't block event default\n            } else {\n                evt.stopPropagation();\n                evt.preventDefault();\n\n                // prevent scroll from triggering event\n                if (evt.type === 'touchend') {\n                    var currentLocation = touches ? touches[0].clientY : 0;\n                    if (Math.abs(currentLocation - initialTouchStartY) > 20) return false;\n                }\n            }\n        }\n\n        var fileElem = elem;\n\n        function resetModel(evt) {\n            if (upload.shouldUpdateOn('click', attr, scope) && fileElem.val()) {\n                fileElem.val(null);\n                upload.updateModel(ngModel, attr, scope, fileChangeAttr(), null, evt, true);\n            }\n        }\n\n        if (!isInputTypeFile()) {\n            fileElem = createFileInput();\n        }\n        fileElem.bind('change', changeFn);\n\n        if (!isInputTypeFile()) {\n            elem.bind('click touchstart touchend', clickHandler);\n        } else {\n            elem.bind('click', resetModel);\n        }\n\n        function ie10SameFileSelectFix(evt) {\n            if (fileElem && !fileElem.attr('__ngf_ie10_Fix_')) {\n                if (!fileElem[0].parentNode) {\n                    fileElem = null;\n                    return;\n                }\n                evt.preventDefault();\n                evt.stopPropagation();\n                fileElem.unbind('click');\n                var clone = fileElem.clone();\n                fileElem.replaceWith(clone);\n                fileElem = clone;\n                fileElem.attr('__ngf_ie10_Fix_', 'true');\n                fileElem.bind('change', changeFn);\n                fileElem.bind('click', ie10SameFileSelectFix);\n                fileElem[0].click();\n                return false;\n            } else {\n                fileElem.removeAttr('__ngf_ie10_Fix_');\n            }\n        }\n\n        if (navigator.appVersion.indexOf('MSIE 10') !== -1) {\n            fileElem.bind('click', ie10SameFileSelectFix);\n        }\n\n        if (ngModel) ngModel.$formatters.push(function (val) {\n            if (val == null || val.length === 0) {\n                if (fileElem.val()) {\n                    fileElem.val(null);\n                }\n            }\n            return val;\n        });\n\n        scope.$on('$destroy', function () {\n            if (!isInputTypeFile()) fileElem.remove();\n            angular.forEach(unwatches, function (unwatch) {\n                unwatch();\n            });\n        });\n\n        $timeout(function () {\n            for (var i = 0; i < generatedElems.length; i++) {\n                var g = generatedElems[i];\n                if (!document.body.contains(g.el[0])) {\n                    generatedElems.splice(i, 1);\n                    g.ref.remove();\n                }\n            }\n        });\n\n        if (window.FileAPI && window.FileAPI.ngfFixIE) {\n            window.FileAPI.ngfFixIE(elem, fileElem, changeFn);\n        }\n    }\n\n    return {\n        restrict: 'AEC',\n        require: '?ngModel',\n        link: function (scope, elem, attr, ngModel) {\n            linkFileSelect(scope, elem, attr, ngModel, $parse, $timeout, $compile, Upload);\n        }\n    };\n}]);\n\n(function () {\n\n    ngFileUpload.service('UploadDataUrl', ['UploadBase', '$timeout', '$q', function (UploadBase, $timeout, $q) {\n        var upload = UploadBase;\n        upload.base64DataUrl = function(file) {\n            if (angular.isArray(file)) {\n                var d = $q.defer(), count = 0;\n                angular.forEach(file, function (f) {\n                    upload.dataUrl(f, true)['finally'](function () {\n                        count++;\n                        if (count === file.length) {\n                            var urls = [];\n                            angular.forEach(file, function (ff) {\n                                urls.push(ff.$ngfDataUrl);\n                            });\n                            d.resolve(urls, file);\n                        }\n                    });\n                });\n                return d.promise;\n            } else {\n                return upload.dataUrl(file, true);\n            }\n        };\n        upload.dataUrl = function (file, disallowObjectUrl) {\n            if ((disallowObjectUrl && file.$ngfDataUrl != null) || (!disallowObjectUrl && file.$ngfBlobUrl != null)) {\n                var d = $q.defer();\n                $timeout(function () {\n                    d.resolve(disallowObjectUrl ? file.$ngfDataUrl : file.$ngfBlobUrl, file);\n                });\n                return d.promise;\n            }\n            var p = disallowObjectUrl ? file.$$ngfDataUrlPromise : file.$$ngfBlobUrlPromise;\n            if (p) return p;\n\n            var deferred = $q.defer();\n            $timeout(function () {\n                if (window.FileReader && file &&\n                    (!window.FileAPI || navigator.userAgent.indexOf('MSIE 8') === -1 || file.size < 20000) &&\n                    (!window.FileAPI || navigator.userAgent.indexOf('MSIE 9') === -1 || file.size < 4000000)) {\n                    //prefer URL.createObjectURL for handling refrences to files of all sizes\n                    //since it doesn´t build a large string in memory\n                    var URL = window.URL || window.webkitURL;\n                    if (URL && URL.createObjectURL && !disallowObjectUrl) {\n                        var url;\n                        try {\n                            url = URL.createObjectURL(file);\n                        } catch (e) {\n                            $timeout(function () {\n                                file.$ngfBlobUrl = '';\n                                deferred.reject();\n                            });\n                            return;\n                        }\n                        $timeout(function () {\n                            file.$ngfBlobUrl = url;\n                            if (url) deferred.resolve(url, file);\n                        });\n                    } else {\n                        var fileReader = new FileReader();\n                        fileReader.onload = function (e) {\n                            $timeout(function () {\n                                file.$ngfDataUrl = e.target.result;\n                                deferred.resolve(e.target.result, file);\n                            });\n                        };\n                        fileReader.onerror = function () {\n                            $timeout(function () {\n                                file.$ngfDataUrl = '';\n                                deferred.reject();\n                            });\n                        };\n                        fileReader.readAsDataURL(file);\n                    }\n                } else {\n                    $timeout(function () {\n                        file[disallowObjectUrl ? 'dataUrl' : 'blobUrl'] = '';\n                        deferred.reject();\n                    });\n                }\n            });\n\n            if (disallowObjectUrl) {\n                p = file.$$ngfDataUrlPromise = deferred.promise;\n            } else {\n                p = file.$$ngfBlobUrlPromise = deferred.promise;\n            }\n            p['finally'](function () {\n                delete file[disallowObjectUrl ? '$$ngfDataUrlPromise' : '$$ngfBlobUrlPromise'];\n            });\n            return p;\n        };\n        return upload;\n    }]);\n\n    function getTagType(el) {\n        if (el.tagName.toLowerCase() === 'img') return 'image';\n        if (el.tagName.toLowerCase() === 'audio') return 'audio';\n        if (el.tagName.toLowerCase() === 'video') return 'video';\n        return /./;\n    }\n\n    var style = angular.element('<style>.ngf-hide{display:none !important}</style>');\n    document.getElementsByTagName('head')[0].appendChild(style[0]);\n\n    function linkFileDirective(Upload, $timeout, scope, elem, attr, directiveName, resizeParams, isBackground) {\n        function constructDataUrl(file) {\n            var disallowObjectUrl = Upload.attrGetter('ngfNoObjectUrl', attr, scope);\n            Upload.dataUrl(file, disallowObjectUrl)['finally'](function () {\n                $timeout(function () {\n                    var src = (disallowObjectUrl ? file.$ngfDataUrl : file.$ngfBlobUrl) || file.$ngfDataUrl;\n                    if (isBackground) {\n                        elem.css('background-image', 'url(\\'' + (src || '') + '\\')');\n                    } else {\n                        elem.attr('src', src);\n                    }\n                    if (src) {\n                        elem.removeClass('ngf-hide');\n                    } else {\n                        elem.addClass('ngf-hide');\n                    }\n                });\n            });\n        }\n\n        $timeout(function () {\n            var unwatch = scope.$watch(attr[directiveName], function (file) {\n                var size = resizeParams;\n                if (directiveName === 'ngfThumbnail') {\n                    if (!size) {\n                        size = {width: elem[0].clientWidth, height: elem[0].clientHeight};\n                    }\n                    if (size.width === 0 && window.getComputedStyle) {\n                        var style = getComputedStyle(elem[0]);\n                        size = {width: parseInt(style.width.slice(0, -2)),\n                            height: parseInt(style.height.slice(0, -2))};\n                    }\n                }\n\n                if (angular.isString(file)) {\n                    elem.removeClass('ngf-hide');\n                    if (isBackground) {\n                        return elem.css('background-image', 'url(\\'' + file + '\\')');\n                    } else {\n                        return elem.attr('src', file);\n                    }\n                }\n                if (file && file.type && file.type.search(getTagType(elem[0])) === 0 &&\n                    (!isBackground || file.type.indexOf('image') === 0)) {\n                    if (size && Upload.isResizeSupported()) {\n                        Upload.resize(file, size.width, size.height, size.quality).then(\n                            function (f) {\n                                constructDataUrl(f);\n                            }, function (e) {\n                                throw e;\n                            }\n                        );\n                    } else {\n                        constructDataUrl(file);\n                    }\n                } else {\n                    elem.addClass('ngf-hide');\n                }\n            });\n\n            scope.$on('$destroy', function () {\n                unwatch();\n            });\n        });\n    }\n\n\n    /** @namespace attr.ngfSrc */\n    /** @namespace attr.ngfNoObjectUrl */\n    ngFileUpload.directive('ngfSrc', ['Upload', '$timeout', function (Upload, $timeout) {\n        return {\n            restrict: 'AE',\n            link: function (scope, elem, attr) {\n                linkFileDirective(Upload, $timeout, scope, elem, attr, 'ngfSrc',\n                    Upload.attrGetter('ngfResize', attr, scope), false);\n            }\n        };\n    }]);\n\n    /** @namespace attr.ngfBackground */\n    /** @namespace attr.ngfNoObjectUrl */\n    ngFileUpload.directive('ngfBackground', ['Upload', '$timeout', function (Upload, $timeout) {\n        return {\n            restrict: 'AE',\n            link: function (scope, elem, attr) {\n                linkFileDirective(Upload, $timeout, scope, elem, attr, 'ngfBackground',\n                    Upload.attrGetter('ngfResize', attr, scope), true);\n            }\n        };\n    }]);\n\n    /** @namespace attr.ngfThumbnail */\n    /** @namespace attr.ngfAsBackground */\n    /** @namespace attr.ngfSize */\n    /** @namespace attr.ngfNoObjectUrl */\n    ngFileUpload.directive('ngfThumbnail', ['Upload', '$timeout', function (Upload, $timeout) {\n        return {\n            restrict: 'AE',\n            link: function (scope, elem, attr) {\n                var size = Upload.attrGetter('ngfSize', attr, scope);\n                linkFileDirective(Upload, $timeout, scope, elem, attr, 'ngfThumbnail', size,\n                    Upload.attrGetter('ngfAsBackground', attr, scope));\n            }\n        };\n    }]);\n\n    //ngFileUpload.config(['$compileProvider', function ($compileProvider) {\n    //  if ($compileProvider.imgSrcSanitizationWhitelist) $compileProvider.imgSrcSanitizationWhitelist(/^\\s*(https?|ftp|mailto|tel|local|file|data|blob):/);\n    //  if ($compileProvider.aHrefSanitizationWhitelist) $compileProvider.aHrefSanitizationWhitelist(/^\\s*(https?|ftp|mailto|tel|local|file|data|blob):/);\n    //}]);\n    //\n    //ngFileUpload.filter('$ngfDataUrl', ['UploadDataUrl', '$sce', function (UploadDataUrl, $sce) {\n    //  return function (file, disallowObjectUrl) {\n    //    if (angular.isString(file)) {\n    //      return $sce.trustAsResourceUrl(file);\n    //    }\n    //    if (file && !file.$ngfDataUrl) {\n    //      if (file.$ngfDataUrl === undefined && angular.isObject(file)) {\n    //        file.$ngfDataUrl = null;\n    //        UploadDataUrl.$ngfDataUrl(file, disallowObjectUrl);\n    //      }\n    //      return '';\n    //    }\n    //    return (file && file.$ngfDataUrl ? $sce.trustAsResourceUrl(file.$ngfDataUrl) : file) || '';\n    //  };\n    //}]);\n\n})();\n\nngFileUpload.service('UploadValidate', ['UploadDataUrl', '$q', '$timeout', function (UploadDataUrl, $q, $timeout) {\n    var upload = UploadDataUrl;\n\n    function globStringToRegex(str) {\n        var regexp = '', excludes = [];\n        if (str.length > 2 && str[0] === '/' && str[str.length - 1] === '/') {\n            regexp = str.substring(1, str.length - 1);\n        } else {\n            var split = str.split(',');\n            if (split.length > 1) {\n                for (var i = 0; i < split.length; i++) {\n                    var r = globStringToRegex(split[i]);\n                    if (r.regexp) {\n                        regexp += '(' + r.regexp + ')';\n                        if (i < split.length - 1) {\n                            regexp += '|';\n                        }\n                    } else {\n                        excludes = excludes.concat(r.excludes);\n                    }\n                }\n            } else {\n                if (str.indexOf('!') === 0) {\n                    excludes.push('^((?!' + globStringToRegex(str.substring(1)).regexp + ').)*$');\n                } else {\n                    if (str.indexOf('.') === 0) {\n                        str = '*' + str;\n                    }\n                    regexp = '^' + str.replace(new RegExp('[.\\\\\\\\+*?\\\\[\\\\^\\\\]$(){}=!<>|:\\\\-]', 'g'), '\\\\$&') + '$';\n                    regexp = regexp.replace(/\\\\\\*/g, '.*').replace(/\\\\\\?/g, '.');\n                }\n            }\n        }\n        return {regexp: regexp, excludes: excludes};\n    }\n\n    upload.validatePattern = function (file, val) {\n        if (!val) {\n            return true;\n        }\n        var pattern = globStringToRegex(val), valid = true;\n        if (pattern.regexp && pattern.regexp.length) {\n            var regexp = new RegExp(pattern.regexp, 'i');\n            valid = (file.type != null && regexp.test(file.type)) ||\n                (file.name != null && regexp.test(file.name));\n        }\n        var len = pattern.excludes.length;\n        while (len--) {\n            var exclude = new RegExp(pattern.excludes[len], 'i');\n            valid = valid && (file.type == null || exclude.test(file.type)) &&\n                (file.name == null || exclude.test(file.name));\n        }\n        return valid;\n    };\n\n    upload.validate = function (files, ngModel, attr, scope, later, callback) {\n        ngModel = ngModel || {};\n        ngModel.$ngfValidations = ngModel.$ngfValidations || [];\n\n        angular.forEach(ngModel.$ngfValidations, function (v) {\n            v.valid = true;\n        });\n\n        var attrGetter = function (name, params) {\n            return upload.attrGetter(name, attr, scope, params);\n        };\n\n        if (later) {\n            callback.call(ngModel);\n            return;\n        }\n        ngModel.$$ngfValidated = true;\n\n        if (files == null || files.length === 0) {\n            callback.call(ngModel);\n            return;\n        }\n\n        files = files.length === undefined ? [files] : files.slice(0);\n\n        function validateSync(name, validatorVal, fn) {\n            if (files) {\n                var dName = 'ngf' + name[0].toUpperCase() + name.substr(1);\n                var i = files.length, valid = null;\n\n                while (i--) {\n                    var file = files[i];\n                    var val = attrGetter(dName, {'$file': file});\n                    if (val == null) {\n                        val = validatorVal(attrGetter('ngfValidate') || {});\n                        valid = valid == null ? true : valid;\n                    }\n                    if (val != null) {\n                        if (!fn(file, val)) {\n                            file.$error = name;\n                            file.$errorParam = val;\n                            files.splice(i, 1);\n                            valid = false;\n                        }\n                    }\n                }\n                if (valid !== null) {\n                    ngModel.$ngfValidations.push({name: name, valid: valid});\n                }\n            }\n        }\n\n        validateSync('pattern', function (cons) {\n            return cons.pattern;\n        }, upload.validatePattern);\n        validateSync('minSize', function (cons) {\n            return cons.size && cons.size.min;\n        }, function (file, val) {\n            return file.size >= upload.translateScalars(val);\n        });\n        validateSync('maxSize', function (cons) {\n            return cons.size && cons.size.max;\n        }, function (file, val) {\n            return file.size <= upload.translateScalars(val);\n        });\n\n        validateSync('validateFn', function () {\n            return null;\n        }, function (file, r) {\n            return r === true || r === null || r === '';\n        });\n\n        if (!files.length) {\n            callback.call(ngModel, ngModel.$ngfValidations);\n            return;\n        }\n\n        var pendings = 0;\n\n        function validateAsync(name, validatorVal, type, asyncFn, fn) {\n            if (files) {\n                var thisPendings = 0, hasError = false, dName = 'ngf' + name[0].toUpperCase() + name.substr(1);\n                files = files.length === undefined ? [files] : files;\n                angular.forEach(files, function (file) {\n                    if (file.type.search(type) !== 0) {\n                        return true;\n                    }\n                    var val = attrGetter(dName, {'$file': file}) || validatorVal(attrGetter('ngfValidate', {'$file': file}) || {});\n                    if (val) {\n                        pendings++;\n                        thisPendings++;\n                        asyncFn(file, val).then(function (d) {\n                            if (!fn(d, val)) {\n                                file.$error = name;\n                                file.$errorParam = val;\n                                hasError = true;\n                            }\n                        }, function () {\n                            if (attrGetter('ngfValidateForce', {'$file': file})) {\n                                file.$error = name;\n                                file.$errorParam = val;\n                                hasError = true;\n                            }\n                        })['finally'](function () {\n                            pendings--;\n                            thisPendings--;\n                            if (!thisPendings) {\n                                ngModel.$ngfValidations.push({name: name, valid: !hasError});\n                            }\n                            if (!pendings) {\n                                callback.call(ngModel, ngModel.$ngfValidations);\n                            }\n                        });\n                    }\n                });\n            }\n        }\n\n        validateAsync('maxHeight', function (cons) {\n            return cons.height && cons.height.max;\n        }, /image/, this.imageDimensions, function (d, val) {\n            return d.height <= val;\n        });\n        validateAsync('minHeight', function (cons) {\n            return cons.height && cons.height.min;\n        }, /image/, this.imageDimensions, function (d, val) {\n            return d.height >= val;\n        });\n        validateAsync('maxWidth', function (cons) {\n            return cons.width && cons.width.max;\n        }, /image/, this.imageDimensions, function (d, val) {\n            return d.width <= val;\n        });\n        validateAsync('minWidth', function (cons) {\n            return cons.width && cons.width.min;\n        }, /image/, this.imageDimensions, function (d, val) {\n            return d.width >= val;\n        });\n        validateAsync('ratio', function (cons) {\n            return cons.ratio;\n        }, /image/, this.imageDimensions, function (d, val) {\n            var split = val.toString().split(','), valid = false;\n\n            for (var i = 0; i < split.length; i++) {\n                var r = split[i], xIndex = r.search(/x/i);\n                if (xIndex > -1) {\n                    r = parseFloat(r.substring(0, xIndex)) / parseFloat(r.substring(xIndex + 1));\n                } else {\n                    r = parseFloat(r);\n                }\n                if (Math.abs((d.width / d.height) - r) < 0.0001) {\n                    valid = true;\n                }\n            }\n            return valid;\n        });\n        validateAsync('maxDuration', function (cons) {\n            return cons.duration && cons.duration.max;\n        }, /audio|video/, this.mediaDuration, function (d, val) {\n            return d <= upload.translateScalars(val);\n        });\n        validateAsync('minDuration', function (cons) {\n            return cons.duration && cons.duration.min;\n        }, /audio|video/, this.mediaDuration, function (d, val) {\n            return d >= upload.translateScalars(val);\n        });\n\n        validateAsync('validateAsyncFn', function () {\n            return null;\n        }, /./, function (file, val) {\n            return val;\n        }, function (r) {\n            return r === true || r === null || r === '';\n        });\n\n        if (!pendings) {\n            callback.call(ngModel, ngModel.$ngfValidations);\n        }\n    };\n\n    upload.imageDimensions = function (file) {\n        if (file.$ngfWidth && file.$ngfHeight) {\n            var d = $q.defer();\n            $timeout(function () {\n                d.resolve({width: file.$ngfWidth, height: file.$ngfHeight});\n            });\n            return d.promise;\n        }\n        if (file.$ngfDimensionPromise) return file.$ngfDimensionPromise;\n\n        var deferred = $q.defer();\n        $timeout(function () {\n            if (file.type.indexOf('image') !== 0) {\n                deferred.reject('not image');\n                return;\n            }\n            upload.dataUrl(file).then(function (dataUrl) {\n                var img = angular.element('<img>').attr('src', dataUrl).css('visibility', 'hidden').css('position', 'fixed');\n\n                function success() {\n                    var width = img[0].clientWidth;\n                    var height = img[0].clientHeight;\n                    img.remove();\n                    file.$ngfWidth = width;\n                    file.$ngfHeight = height;\n                    deferred.resolve({width: width, height: height});\n                }\n\n                function error() {\n                    img.remove();\n                    deferred.reject('load error');\n                }\n\n                img.on('load', success);\n                img.on('error', error);\n                var count = 0;\n\n                function checkLoadError() {\n                    $timeout(function () {\n                        if (img[0].parentNode) {\n                            if (img[0].clientWidth) {\n                                success();\n                            } else if (count > 10) {\n                                error();\n                            } else {\n                                checkLoadError();\n                            }\n                        }\n                    }, 1000);\n                }\n\n                checkLoadError();\n\n                angular.element(document.getElementsByTagName('body')[0]).append(img);\n            }, function () {\n                deferred.reject('load error');\n            });\n        });\n\n        file.$ngfDimensionPromise = deferred.promise;\n        file.$ngfDimensionPromise['finally'](function () {\n            delete file.$ngfDimensionPromise;\n        });\n        return file.$ngfDimensionPromise;\n    };\n\n    upload.mediaDuration = function (file) {\n        if (file.$ngfDuration) {\n            var d = $q.defer();\n            $timeout(function () {\n                d.resolve(file.$ngfDuration);\n            });\n            return d.promise;\n        }\n        if (file.$ngfDurationPromise) return file.$ngfDurationPromise;\n\n        var deferred = $q.defer();\n        $timeout(function () {\n            if (file.type.indexOf('audio') !== 0 && file.type.indexOf('video') !== 0) {\n                deferred.reject('not media');\n                return;\n            }\n            upload.dataUrl(file).then(function (dataUrl) {\n                var el = angular.element(file.type.indexOf('audio') === 0 ? '<audio>' : '<video>')\n                    .attr('src', dataUrl).css('visibility', 'none').css('position', 'fixed');\n\n                function success() {\n                    var duration = el[0].duration;\n                    file.$ngfDuration = duration;\n                    el.remove();\n                    deferred.resolve(duration);\n                }\n\n                function error() {\n                    el.remove();\n                    deferred.reject('load error');\n                }\n\n                el.on('loadedmetadata', success);\n                el.on('error', error);\n                var count = 0;\n\n                function checkLoadError() {\n                    $timeout(function () {\n                        if (el[0].parentNode) {\n                            if (el[0].duration) {\n                                success();\n                            } else if (count > 10) {\n                                error();\n                            } else {\n                                checkLoadError();\n                            }\n                        }\n                    }, 1000);\n                }\n\n                checkLoadError();\n\n                angular.element(document.body).append(el);\n            }, function () {\n                deferred.reject('load error');\n            });\n        });\n\n        file.$ngfDurationPromise = deferred.promise;\n        file.$ngfDurationPromise['finally'](function () {\n            delete file.$ngfDurationPromise;\n        });\n        return file.$ngfDurationPromise;\n    };\n    return upload;\n}\n]);\n\n// source: Source: https://github.com/romelgomez/angular-firebase-image-upload/blob/master/app/scripts/fileUpload.js#L89\n\nngFileUpload.service('UploadResize', ['UploadValidate', '$q', '$timeout', function (UploadValidate, $q, $timeout) {\n    var upload = UploadValidate;\n\n    /**\n     * Conserve aspect ratio of the original region. Useful when shrinking/enlarging\n     * images to fit into a certain area.\n     * Source:  http://stackoverflow.com/a/14731922\n     *\n     * @param {Number} srcWidth Source area width\n     * @param {Number} srcHeight Source area height\n     * @param {Number} maxWidth Nestable area maximum available width\n     * @param {Number} maxHeight Nestable area maximum available height\n     * @return {Object} { width, height }\n     */\n    var calculateAspectRatioFit = function (srcWidth, srcHeight, maxWidth, maxHeight) {\n        var ratio = Math.min(maxWidth / srcWidth, maxHeight / srcHeight);\n        return {width: srcWidth * ratio, height: srcHeight * ratio};\n    };\n\n    /**\n     Reduce imagen size and quality.\n     @param {String} imagen is a base64 string\n     @param {Number} width\n     @param {Number} height\n     @param {Number} quality from 0.1 to 1.0\n     @return Promise.<String>\n     **/\n    var resize = function (imagen, width, height, quality, type) {\n        var deferred = $q.defer();\n        var canvasElement = document.createElement('canvas');\n        var imagenElement = document.createElement('img');\n\n        imagenElement.onload = function () {\n            try {\n                if (width === 0) {\n                    width = imagenElement.width;\n                    height = imagenElement.height;\n                }\n                var dimensions = calculateAspectRatioFit(imagenElement.width, imagenElement.height, width, height);\n                canvasElement.width = dimensions.width;\n                canvasElement.height = dimensions.height;\n                var context = canvasElement.getContext('2d');\n                context.drawImage(imagenElement, 0, 0, dimensions.width, dimensions.height);\n                deferred.resolve(canvasElement.toDataURL(type || 'image/WebP', quality || 1.0));\n            } catch (e) {\n                deferred.reject(e);\n            }\n        };\n        imagenElement.onerror = function () {\n            deferred.reject();\n        };\n        imagenElement.src = imagen;\n        return deferred.promise;\n    };\n\n    var dataURLtoBlob = function (dataurl) {\n        var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],\n            bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);\n        while (n--) {\n            u8arr[n] = bstr.charCodeAt(n);\n        }\n        return new Blob([u8arr], {type: mime});\n    };\n\n    upload.isResizeSupported = function () {\n        var elem = document.createElement('canvas');\n        return window.atob && elem.getContext && elem.getContext('2d');\n    };\n\n    upload.resize = function (file, width, height, quality) {\n        var deferred = $q.defer();\n        if (file.type.indexOf('image') !== 0) {\n            $timeout(function () {\n                deferred.resolve('Only images are allowed for resizing!');\n            });\n            return deferred.promise;\n        }\n\n        upload.dataUrl(file, true).then(function (url) {\n            resize(url, width, height, quality, file.type).then(function (dataUrl) {\n                var blob = dataURLtoBlob(dataUrl);\n                blob.name = file.name;\n                deferred.resolve(blob);\n            }, function () {\n                deferred.reject();\n            });\n        }, function () {\n            deferred.reject();\n        });\n        return deferred.promise;\n    };\n\n    return upload;\n}]);\n\n(function () {\n    ngFileUpload.directive('ngfDrop', ['$parse', '$timeout', '$location', 'Upload', '$http',\n        function ($parse, $timeout, $location, Upload, $http) {\n            return {\n                restrict: 'AEC',\n                require: '?ngModel',\n                link: function (scope, elem, attr, ngModel) {\n                    linkDrop(scope, elem, attr, ngModel, $parse, $timeout, $location, Upload, $http);\n                }\n            };\n        }]);\n\n    ngFileUpload.directive('ngfNoFileDrop', function () {\n        return function (scope, elem) {\n            if (dropAvailable()) elem.css('display', 'none');\n        };\n    });\n\n    ngFileUpload.directive('ngfDropAvailable', ['$parse', '$timeout', 'Upload', function ($parse, $timeout, Upload) {\n        return function (scope, elem, attr) {\n            if (dropAvailable()) {\n                var model = $parse(Upload.attrGetter('ngfDropAvailable', attr));\n                $timeout(function () {\n                    model(scope);\n                    if (model.assign) {\n                        model.assign(scope, true);\n                    }\n                });\n            }\n        };\n    }]);\n\n    function linkDrop(scope, elem, attr, ngModel, $parse, $timeout, $location, upload, $http) {\n        var available = dropAvailable();\n\n        var attrGetter = function (name, scope, params) {\n            return upload.attrGetter(name, attr, scope, params);\n        };\n\n        if (attrGetter('dropAvailable')) {\n            $timeout(function () {\n                if (scope[attrGetter('dropAvailable')]) {\n                    scope[attrGetter('dropAvailable')].value = available;\n                } else {\n                    scope[attrGetter('dropAvailable')] = available;\n                }\n            });\n        }\n        if (!available) {\n            if (attrGetter('ngfHideOnDropNotAvailable', scope) === true) {\n                elem.css('display', 'none');\n            }\n            return;\n        }\n\n        function isDisabled() {\n            return elem.attr('disabled') || attrGetter('ngfDropDisabled', scope);\n        }\n\n        var leaveTimeout = null;\n        var stopPropagation = $parse(attrGetter('ngfStopPropagation'));\n        var dragOverDelay = 1;\n        var actualDragOverClass;\n\n        elem[0].addEventListener('dragover', function (evt) {\n            if (isDisabled()) return;\n            evt.preventDefault();\n            if (stopPropagation(scope)) evt.stopPropagation();\n            // handling dragover events from the Chrome download bar\n            if (navigator.userAgent.indexOf('Chrome') > -1) {\n                var b = evt.dataTransfer.effectAllowed;\n                evt.dataTransfer.dropEffect = ('move' === b || 'linkMove' === b) ? 'move' : 'copy';\n            }\n            $timeout.cancel(leaveTimeout);\n            if (!actualDragOverClass) {\n                actualDragOverClass = 'C';\n                calculateDragOverClass(scope, attr, evt, function (clazz) {\n                    actualDragOverClass = clazz;\n                    elem.addClass(actualDragOverClass);\n                    attrGetter('ngfDrag', scope, {$isDragging: true, $class: actualDragOverClass, $event: evt});\n                });\n            }\n        }, false);\n        elem[0].addEventListener('dragenter', function (evt) {\n            if (isDisabled()) return;\n            evt.preventDefault();\n            if (stopPropagation(scope)) evt.stopPropagation();\n        }, false);\n        elem[0].addEventListener('dragleave', function (evt) {\n            if (isDisabled()) return;\n            evt.preventDefault();\n            if (stopPropagation(scope)) evt.stopPropagation();\n            leaveTimeout = $timeout(function () {\n                if (actualDragOverClass) elem.removeClass(actualDragOverClass);\n                actualDragOverClass = null;\n                attrGetter('ngfDrag', scope, {$isDragging: false, $event: evt});\n            }, dragOverDelay || 100);\n        }, false);\n        elem[0].addEventListener('drop', function (evt) {\n            if (isDisabled() || !upload.shouldUpdateOn('drop', attr, scope)) return;\n            evt.preventDefault();\n            if (stopPropagation(scope)) evt.stopPropagation();\n            if (actualDragOverClass) elem.removeClass(actualDragOverClass);\n            actualDragOverClass = null;\n            var html;\n            try {\n                html = (evt.dataTransfer && evt.dataTransfer.getData && evt.dataTransfer.getData('text/html'));\n            } catch (e) {/* Fix IE11 that throw error calling getData */}\n            if (html) {\n                var url;\n                html.replace(/<img .*src *=\\\"([^\\\"]*)\\\"/, function (m, src) {\n                    url = src;\n                });\n                if (url) {\n                    $http({url: url, method: 'get', responseType: 'arraybuffer'}).then(function (resp) {\n                        var arrayBufferView = new Uint8Array(resp.data);\n                        var type = resp.headers('content-type') || 'image/jpg';\n                        var blob = new Blob([arrayBufferView], {type: type});\n                        //var split = type.split('[/;]');\n                        //blob.name = url.substring(0, 150).replace(/\\W+/g, '') + '.' + (split.length > 1 ? split[1] : 'jpg');\n                        upload.updateModel(ngModel, attr, scope, attrGetter('ngfChange') || attrGetter('ngfDrop'), [blob], evt);\n                    });\n                }\n            } else {\n                extractFiles(evt, function (files) {\n                        upload.updateModel(ngModel, attr, scope, attrGetter('ngfChange') || attrGetter('ngfDrop'), files, evt);\n                    }, attrGetter('ngfAllowDir', scope) !== false,\n                    attrGetter('multiple') || attrGetter('ngfMultiple', scope));\n            }\n        }, false);\n        elem[0].addEventListener('paste', function (evt) {\n            if (isDisabled() || !upload.shouldUpdateOn('paste', attr, scope)) return;\n            var files = [];\n            var clipboard = evt.clipboardData || evt.originalEvent.clipboardData;\n            if (clipboard && clipboard.items) {\n                for (var k = 0; k < clipboard.items.length; k++) {\n                    if (clipboard.items[k].type.indexOf('image') !== -1) {\n                        files.push(clipboard.items[k].getAsFile());\n                    }\n                }\n                upload.updateModel(ngModel, attr, scope, attrGetter('ngfChange') || attrGetter('ngfDrop'), files, evt);\n            }\n        }, false);\n\n        function calculateDragOverClass(scope, attr, evt, callback) {\n            var obj = attrGetter('ngfDragOverClass', scope, {$event: evt}), dClass = 'dragover';\n            if (angular.isString(obj)) {\n                dClass = obj;\n            } else if (obj) {\n                if (obj.delay) dragOverDelay = obj.delay;\n                if (obj.accept || obj.reject) {\n                    var items = evt.dataTransfer.items;\n                    if (items == null || !items.length) {\n                        dClass = obj.accept;\n                    } else {\n                        var pattern = obj.pattern || attrGetter('ngfPattern', scope, {$event: evt});\n                        var len = items.length;\n                        while (len--) {\n                            if (!upload.validatePattern(items[len], pattern)) {\n                                dClass = obj.reject;\n                                break;\n                            } else {\n                                dClass = obj.accept;\n                            }\n                        }\n                    }\n                }\n            }\n            callback(dClass);\n        }\n\n        function extractFiles(evt, callback, allowDir, multiple) {\n            var files = [], processing = 0;\n\n            function traverseFileTree(files, entry, path) {\n                if (entry != null) {\n                    if (entry.isDirectory) {\n                        var filePath = (path || '') + entry.name;\n                        files.push({name: entry.name, type: 'directory', path: filePath});\n                        var dirReader = entry.createReader();\n                        var entries = [];\n                        processing++;\n                        var readEntries = function () {\n                            dirReader.readEntries(function (results) {\n                                try {\n                                    if (!results.length) {\n                                        for (var i = 0; i < entries.length; i++) {\n                                            traverseFileTree(files, entries[i], (path ? path : '') + entry.name + '/');\n                                        }\n                                        processing--;\n                                    } else {\n                                        entries = entries.concat(Array.prototype.slice.call(results || [], 0));\n                                        readEntries();\n                                    }\n                                } catch (e) {\n                                    processing--;\n                                    console.error(e);\n                                }\n                            }, function () {\n                                processing--;\n                            });\n                        };\n                        readEntries();\n                    } else {\n                        processing++;\n                        entry.file(function (file) {\n                            try {\n                                processing--;\n                                file.path = (path ? path : '') + file.name;\n                                files.push(file);\n                            } catch (e) {\n                                processing--;\n                                console.error(e);\n                            }\n                        }, function () {\n                            processing--;\n                        });\n                    }\n                }\n            }\n\n            var items = evt.dataTransfer.items;\n\n            if (items && items.length > 0 && $location.protocol() !== 'file') {\n                for (var i = 0; i < items.length; i++) {\n                    if (items[i].webkitGetAsEntry && items[i].webkitGetAsEntry() && items[i].webkitGetAsEntry().isDirectory) {\n                        var entry = items[i].webkitGetAsEntry();\n                        if (entry.isDirectory && !allowDir) {\n                            continue;\n                        }\n                        if (entry != null) {\n                            traverseFileTree(files, entry);\n                        }\n                    } else {\n                        var f = items[i].getAsFile();\n                        if (f != null) files.push(f);\n                    }\n                    if (!multiple && files.length > 0) break;\n                }\n            } else {\n                var fileList = evt.dataTransfer.files;\n                if (fileList != null) {\n                    for (var j = 0; j < fileList.length; j++) {\n                        files.push(fileList.item(j));\n                        if (!multiple && files.length > 0) {\n                            break;\n                        }\n                    }\n                }\n            }\n            var delays = 0;\n            (function waitForProcess(delay) {\n                $timeout(function () {\n                    if (!processing) {\n                        if (!multiple && files.length > 1) {\n                            i = 0;\n                            while (files[i].type === 'directory') i++;\n                            files = [files[i]];\n                        }\n                        callback(files);\n                    } else {\n                        if (delays++ * 10 < 20 * 1000) {\n                            waitForProcess(10);\n                        }\n                    }\n                }, delay || 0);\n            })();\n        }\n    }\n\n    function dropAvailable() {\n        var div = document.createElement('div');\n        return ('draggable' in div) && ('ondrop' in div) && !/Edge\\/12./i.test(navigator.userAgent);\n    }\n\n})();"],"sourceRoot":"/source/"}