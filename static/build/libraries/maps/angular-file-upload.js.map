{"version":3,"sources":["angular-file-upload.js"],"names":["patchXHR","fnName","newFn","window","XMLHttpRequest","prototype","redefineProp","xhr","prop","fn","Object","defineProperty","get","e","FileAPI","shouldLoad","FormData","forceLoad","initializeUploadListener","__listeners","upload","origAddEventListener","addEventListener","t","apply","this","arguments","orig","m","url","b","__url","message","indexOf","__origError","h","__fileApiXHR","getResponseHeader","getAllResponseHeaders","abort","header","value","val","Function","__requestHeaders","__isFileAPIShim","formData","config","jsonp","cache","complete","err","fileApiXHR","__completed","load","type","loaded","__loaded","total","__total","target","lengthComputable","loadend","undefined","status","statusText","response","resp","responseText","onreadystatechange","onload","progress","_this","setTimeout","noContentTimeout","headers","data","files","i","length","item","name","size","key","hasFlash","append","__isFileAPIBlobShim","push","Blob","isInputTypeFile","elem","tagName","toLowerCase","attr","fo","ActiveXObject","navigator","mimeTypes","getOffset","obj","left","top","jQuery","offset","offsetParent","offsetLeft","scrollLeft","offsetTop","scrollTop","html5","jsUrl","basePath","index","src","script","document","createElement","allScripts","getElementsByTagName","jsPath","search","substring","staticPath","setAttribute","appendChild","ngfFixIE","createFileElemFn","bindAttr","changeFn","makeFlashInput","$$ngfRefElem","removeClass","fileElem","addClass","bind","evt","fileApiChangeFn","css","offsetWidth","offsetHeight","getFiles","__files_","disableFileInput","disable","FileReader","loadStarted","listeners","removeEventListener","splice","dispatchEvent","list","call","onabort","onerror","onloadstart","onloadend","onprogress","constructEvent","error","result","listener","readAsArrayBuffer","file","readAsBinaryString","readAsDataURL","readAsText","setRequestHeader","ngFileUpload","angular","module","version","defaults","service","$http","$q","$timeout","sendHttp","method","deferred","defer","promise","__setXHR_","__XHR","xhrFn","notify","progressFunc","then","r","resolve","reject","n","success","update","origXhrFn","addFieldToFormData","isDate","toISOString","isString","sendFieldsAs","isObject","k","hasOwnProperty","JSON","stringify","transformRequest","isArray","allFields","fields","formDataAppender","fileFormName","fileFormDataName","isFileFormNameString","fileName","http","ArrayBuffer","dataUrl","callback","disallowObjectUrl","userAgent","URL","webkitURL","createObjectURL","fileReader","setDefaults","linkFileSelect","scope","ngModel","$parse","$compile","isUpdating","fileList","rejFiles","validate","updateModel","getAttr","bindAttrToFileInput","attributes","attribute","createFileInput","resetOnClick","element","replaceWith","remove","body","resetModel","clickHandler","clickAndAssign","clientY","click","disabled","initialTouchStartY","originalEvent","touches","stopPropagation","preventDefault","currentLocation","changedTouches","Math","abs","shouldClickLater","$on","$watch","ua","match","v","androidFixMinorVersion","parseInt","test","getAttrWithDefaults","toString","directive","restrict","require","link","globStringToRegex","str","split","replace","RegExp","accept","$file","$event","fileSizeMax","fileSizeMin","regexp","$error","fileChange","noDelay","keep","prevFiles","$modelValue","slice","len","j","concat","singleModel","assign","$setViewValue","ngfModel","$files","$rejectedFiles","linkDrop","$location","calculateDragOverClass","accepted","items","dataTransfer","kind","clazz","delay","dragOverDelay","extractFiles","allowDir","multiple","addFile","traverseFileTree","entry","path","isDirectory","filePath","dirReader","createReader","entries","processing","readEntries","results","Array","console","protocol","webkitGetAsEntry","f","getAsFile","delays","waitForProcess","available","dropAvailable","actualDragOverClass","leaveTimeout","effectAllowed","dropEffect","cancel","div","fileToSrc","Upload","defaultName","ngfNoObjectUrl","ngfSrc","ngfDefaultSrc","ngfBackground","ngfDefaultBackground","ngfDataUrl","ngfDefaultDataUrl"],"mappings":"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","file":"angular-file-upload.js","sourcesContent":["/**!\r\n * AngularJS file upload/drop directive and service with progress and abort\r\n * FileAPI Flash shim for old browsers not supporting FormData\r\n * @author  Danial  <danial.farid@gmail.com>\r\n * @version 6.0.2\r\n */\r\n\r\n(function () {\r\n    /** @module FileAPI.noContentTimeout */\r\n\r\n    function patchXHR(fnName, newFn) {\r\n        window.XMLHttpRequest.prototype[fnName] = newFn(window.XMLHttpRequest.prototype[fnName]);\r\n    }\r\n\r\n    function redefineProp(xhr, prop, fn) {\r\n        try {\r\n            Object.defineProperty(xhr, prop, {get: fn});\r\n        } catch (e) {/*ignore*/\r\n        }\r\n    }\r\n\r\n    if (!window.FileAPI) {\r\n        window.FileAPI = {};\r\n    }\r\n\r\n    FileAPI.shouldLoad = (window.XMLHttpRequest && !window.FormData) || FileAPI.forceLoad;\r\n    if (FileAPI.shouldLoad) {\r\n        var initializeUploadListener = function (xhr) {\r\n            if (!xhr.__listeners) {\r\n                if (!xhr.upload) xhr.upload = {};\r\n                xhr.__listeners = [];\r\n                var origAddEventListener = xhr.upload.addEventListener;\r\n                xhr.upload.addEventListener = function (t, fn) {\r\n                    xhr.__listeners[t] = fn;\r\n                    if (origAddEventListener) origAddEventListener.apply(this, arguments);\r\n                };\r\n            }\r\n        };\r\n\r\n        patchXHR('open', function (orig) {\r\n            return function (m, url, b) {\r\n                initializeUploadListener(this);\r\n                this.__url = url;\r\n                try {\r\n                    orig.apply(this, [m, url, b]);\r\n                } catch (e) {\r\n                    if (e.message.indexOf('Access is denied') > -1) {\r\n                        this.__origError = e;\r\n                        orig.apply(this, [m, '_fix_for_ie_crossdomain__', b]);\r\n                    }\r\n                }\r\n            };\r\n        });\r\n\r\n        patchXHR('getResponseHeader', function (orig) {\r\n            return function (h) {\r\n                return this.__fileApiXHR && this.__fileApiXHR.getResponseHeader ? this.__fileApiXHR.getResponseHeader(h) : (orig == null ? null : orig.apply(this, [h]));\r\n            };\r\n        });\r\n\r\n        patchXHR('getAllResponseHeaders', function (orig) {\r\n            return function () {\r\n                return this.__fileApiXHR && this.__fileApiXHR.getAllResponseHeaders ? this.__fileApiXHR.getAllResponseHeaders() : (orig == null ? null : orig.apply(this));\r\n            };\r\n        });\r\n\r\n        patchXHR('abort', function (orig) {\r\n            return function () {\r\n                return this.__fileApiXHR && this.__fileApiXHR.abort ? this.__fileApiXHR.abort() : (orig == null ? null : orig.apply(this));\r\n            };\r\n        });\r\n\r\n        patchXHR('setRequestHeader', function (orig) {\r\n            return function (header, value) {\r\n                if (header === '__setXHR_') {\r\n                    initializeUploadListener(this);\r\n                    var val = value(this);\r\n                    // fix for angular < 1.2.0\r\n                    if (val instanceof Function) {\r\n                        val(this);\r\n                    }\r\n                } else {\r\n                    this.__requestHeaders = this.__requestHeaders || {};\r\n                    this.__requestHeaders[header] = value;\r\n                    orig.apply(this, arguments);\r\n                }\r\n            };\r\n        });\r\n\r\n        patchXHR('send', function (orig) {\r\n            return function () {\r\n                var xhr = this;\r\n                if (arguments[0] && arguments[0].__isFileAPIShim) {\r\n                    var formData = arguments[0];\r\n                    var config = {\r\n                        url: xhr.__url,\r\n                        jsonp: false, //removes the callback form param\r\n                        cache: true, //removes the ?fileapiXXX in the url\r\n                        complete: function (err, fileApiXHR) {\r\n                            xhr.__completed = true;\r\n                            if (!err && xhr.__listeners.load)\r\n                                xhr.__listeners.load({\r\n                                    type: 'load',\r\n                                    loaded: xhr.__loaded,\r\n                                    total: xhr.__total,\r\n                                    target: xhr,\r\n                                    lengthComputable: true\r\n                                });\r\n                            if (!err && xhr.__listeners.loadend)\r\n                                xhr.__listeners.loadend({\r\n                                    type: 'loadend',\r\n                                    loaded: xhr.__loaded,\r\n                                    total: xhr.__total,\r\n                                    target: xhr,\r\n                                    lengthComputable: true\r\n                                });\r\n                            if (err === 'abort' && xhr.__listeners.abort)\r\n                                xhr.__listeners.abort({\r\n                                    type: 'abort',\r\n                                    loaded: xhr.__loaded,\r\n                                    total: xhr.__total,\r\n                                    target: xhr,\r\n                                    lengthComputable: true\r\n                                });\r\n                            if (fileApiXHR.status !== undefined) redefineProp(xhr, 'status', function () {\r\n                                return (fileApiXHR.status === 0 && err && err !== 'abort') ? 500 : fileApiXHR.status;\r\n                            });\r\n                            if (fileApiXHR.statusText !== undefined) redefineProp(xhr, 'statusText', function () {\r\n                                return fileApiXHR.statusText;\r\n                            });\r\n                            redefineProp(xhr, 'readyState', function () {\r\n                                return 4;\r\n                            });\r\n                            if (fileApiXHR.response !== undefined) redefineProp(xhr, 'response', function () {\r\n                                return fileApiXHR.response;\r\n                            });\r\n                            var resp = fileApiXHR.responseText || (err && fileApiXHR.status === 0 && err !== 'abort' ? err : undefined);\r\n                            redefineProp(xhr, 'responseText', function () {\r\n                                return resp;\r\n                            });\r\n                            redefineProp(xhr, 'response', function () {\r\n                                return resp;\r\n                            });\r\n                            if (err) redefineProp(xhr, 'err', function () {\r\n                                return err;\r\n                            });\r\n                            xhr.__fileApiXHR = fileApiXHR;\r\n                            if (xhr.onreadystatechange) xhr.onreadystatechange();\r\n                            if (xhr.onload) xhr.onload();\r\n                        },\r\n                        progress: function (e) {\r\n                            e.target = xhr;\r\n                            if (xhr.__listeners.progress) xhr.__listeners.progress(e);\r\n                            xhr.__total = e.total;\r\n                            xhr.__loaded = e.loaded;\r\n                            if (e.total === e.loaded) {\r\n                                // fix flash issue that doesn't call complete if there is no response text from the server\r\n                                var _this = this;\r\n                                setTimeout(function () {\r\n                                    if (!xhr.__completed) {\r\n                                        xhr.getAllResponseHeaders = function () {\r\n                                        };\r\n                                        _this.complete(null, {status: 204, statusText: 'No Content'});\r\n                                    }\r\n                                }, FileAPI.noContentTimeout || 10000);\r\n                            }\r\n                        },\r\n                        headers: xhr.__requestHeaders\r\n                    };\r\n                    config.data = {};\r\n                    config.files = {};\r\n                    for (var i = 0; i < formData.data.length; i++) {\r\n                        var item = formData.data[i];\r\n                        if (item.val != null && item.val.name != null && item.val.size != null && item.val.type != null) {\r\n                            config.files[item.key] = item.val;\r\n                        } else {\r\n                            config.data[item.key] = item.val;\r\n                        }\r\n                    }\r\n\r\n                    setTimeout(function () {\r\n                        if (!FileAPI.hasFlash) {\r\n                            throw 'Adode Flash Player need to be installed. To check ahead use \"FileAPI.hasFlash\"';\r\n                        }\r\n                        xhr.__fileApiXHR = FileAPI.upload(config);\r\n                    }, 1);\r\n                } else {\r\n                    if (this.__origError) {\r\n                        throw this.__origError;\r\n                    }\r\n                    orig.apply(xhr, arguments);\r\n                }\r\n            };\r\n        });\r\n        window.XMLHttpRequest.__isFileAPIShim = true;\r\n        window.FormData = FormData = function () {\r\n            return {\r\n                append: function (key, val, name) {\r\n                    if (val.__isFileAPIBlobShim) {\r\n                        val = val.data[0];\r\n                    }\r\n                    this.data.push({\r\n                        key: key,\r\n                        val: val,\r\n                        name: name\r\n                    });\r\n                },\r\n                data: [],\r\n                __isFileAPIShim: true\r\n            };\r\n        };\r\n\r\n        window.Blob = Blob = function (b) {\r\n            return {\r\n                data: b,\r\n                __isFileAPIBlobShim: true\r\n            };\r\n        };\r\n    }\r\n\r\n})();\r\n\r\n(function () {\r\n    /** @module FileAPI.forceLoad */\r\n    /** @module window.FileAPI.jsUrl */\r\n    /** @module window.FileAPI.jsPath */\r\n\r\n    function isInputTypeFile(elem) {\r\n        return elem[0].tagName.toLowerCase() === 'input' && elem.attr('type') && elem.attr('type').toLowerCase() === 'file';\r\n    }\r\n\r\n    function hasFlash() {\r\n        try {\r\n            var fo = new ActiveXObject('ShockwaveFlash.ShockwaveFlash');\r\n            if (fo) return true;\r\n        } catch (e) {\r\n            if (navigator.mimeTypes['application/x-shockwave-flash'] !== undefined) return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function getOffset(obj) {\r\n        var left = 0, top = 0;\r\n\r\n        if (window.jQuery) {\r\n            return jQuery(obj).offset();\r\n        }\r\n\r\n        if (obj.offsetParent) {\r\n            do {\r\n                left += (obj.offsetLeft - obj.scrollLeft);\r\n                top += (obj.offsetTop - obj.scrollTop);\r\n                obj = obj.offsetParent;\r\n            } while (obj);\r\n        }\r\n        return {\r\n            left: left,\r\n            top: top\r\n        };\r\n    }\r\n\r\n    if (FileAPI.shouldLoad) {\r\n\r\n        //load FileAPI\r\n        if (FileAPI.forceLoad) {\r\n            FileAPI.html5 = false;\r\n        }\r\n\r\n        if (!FileAPI.upload) {\r\n            var jsUrl, basePath, script = document.createElement('script'), allScripts = document.getElementsByTagName('script'), i, index, src;\r\n            if (window.FileAPI.jsUrl) {\r\n                jsUrl = window.FileAPI.jsUrl;\r\n            } else if (window.FileAPI.jsPath) {\r\n                basePath = window.FileAPI.jsPath;\r\n            } else {\r\n                for (i = 0; i < allScripts.length; i++) {\r\n                    src = allScripts[i].src;\r\n                    index = src.search(/\\/ng\\-file\\-upload[\\-a-zA-z0-9\\.]*\\.js/);\r\n                    if (index > -1) {\r\n                        basePath = src.substring(0, index + 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (FileAPI.staticPath == null) FileAPI.staticPath = basePath;\r\n            script.setAttribute('src', jsUrl || basePath + 'FileAPI.min.js');\r\n            document.getElementsByTagName('head')[0].appendChild(script);\r\n\r\n            FileAPI.hasFlash = hasFlash();\r\n        }\r\n\r\n        FileAPI.ngfFixIE = function (elem, createFileElemFn, bindAttr, changeFn) {\r\n            if (!hasFlash()) {\r\n                throw 'Adode Flash Player need to be installed. To check ahead use \"FileAPI.hasFlash\"';\r\n            }\r\n            var makeFlashInput = function () {\r\n                if (elem.attr('disabled')) {\r\n                    elem.$$ngfRefElem.removeClass('js-fileapi-wrapper');\r\n                } else {\r\n                    var fileElem = elem.$$ngfRefElem;\r\n                    if (!fileElem) {\r\n                        fileElem = elem.$$ngfRefElem = createFileElemFn();\r\n                        fileElem.addClass('js-fileapi-wrapper');\r\n                        if (!isInputTypeFile(elem)) {\r\n//\t\t\t\t\t\tif (fileElem.parent().css('position') === '' || fileElem.parent().css('position') === 'static') {\r\n//\t\t\t\t\t\t\tfileElem.parent().css('position', 'relative');\r\n//\t\t\t\t\t\t}\r\n//\t\t\t\t\t\telem.parent()[0].insertBefore(fileElem[0], elem[0]);\r\n//\t\t\t\t\t\telem.css('overflow', 'hidden');\r\n                        }\r\n                        setTimeout(function () {\r\n                            fileElem.bind('mouseenter', makeFlashInput);\r\n                        }, 10);\r\n                        fileElem.bind('change', function (evt) {\r\n                            fileApiChangeFn.apply(this, [evt]);\r\n                            changeFn.apply(this, [evt]);\r\n//\t\t\t\t\t\talert('change' +  evt);\r\n                        });\r\n                    } else {\r\n                        bindAttr(elem.$$ngfRefElem);\r\n                    }\r\n                    if (!isInputTypeFile(elem)) {\r\n                        fileElem.css('position', 'absolute')\r\n                            .css('top', getOffset(elem[0]).top + 'px').css('left', getOffset(elem[0]).left + 'px')\r\n                            .css('width', elem[0].offsetWidth + 'px').css('height', elem[0].offsetHeight + 'px')\r\n                            .css('filter', 'alpha(opacity=0)').css('display', elem.css('display'))\r\n                            .css('overflow', 'hidden').css('z-index', '900000')\r\n                            .css('visibility', 'visible');\r\n                    }\r\n                }\r\n            };\r\n\r\n            elem.bind('mouseenter', makeFlashInput);\r\n\r\n            var fileApiChangeFn = function (evt) {\r\n                var files = FileAPI.getFiles(evt);\r\n                //just a double check for #233\r\n                for (var i = 0; i < files.length; i++) {\r\n                    if (files[i].size === undefined) files[i].size = 0;\r\n                    if (files[i].name === undefined) files[i].name = 'file';\r\n                    if (files[i].type === undefined) files[i].type = 'undefined';\r\n                }\r\n                if (!evt.target) {\r\n                    evt.target = {};\r\n                }\r\n                evt.target.files = files;\r\n                // if evt.target.files is not writable use helper field\r\n                if (evt.target.files !== files) {\r\n                    evt.__files_ = files;\r\n                }\r\n                (evt.__files_ || evt.target.files).item = function (i) {\r\n                    return (evt.__files_ || evt.target.files)[i] || null;\r\n                };\r\n            };\r\n        };\r\n\r\n        FileAPI.disableFileInput = function (elem, disable) {\r\n            if (disable) {\r\n                elem.removeClass('js-fileapi-wrapper');\r\n            } else {\r\n                elem.addClass('js-fileapi-wrapper');\r\n            }\r\n        };\r\n    }\r\n})();\r\n\r\nif (!window.FileReader) {\r\n    window.FileReader = function () {\r\n        var _this = this, loadStarted = false;\r\n        this.listeners = {};\r\n        this.addEventListener = function (type, fn) {\r\n            _this.listeners[type] = _this.listeners[type] || [];\r\n            _this.listeners[type].push(fn);\r\n        };\r\n        this.removeEventListener = function (type, fn) {\r\n            if (_this.listeners[type]) _this.listeners[type].splice(_this.listeners[type].indexOf(fn), 1);\r\n        };\r\n        this.dispatchEvent = function (evt) {\r\n            var list = _this.listeners[evt.type];\r\n            if (list) {\r\n                for (var i = 0; i < list.length; i++) {\r\n                    list[i].call(_this, evt);\r\n                }\r\n            }\r\n        };\r\n        this.onabort = this.onerror = this.onload = this.onloadstart = this.onloadend = this.onprogress = null;\r\n\r\n        var constructEvent = function (type, evt) {\r\n            var e = {type: type, target: _this, loaded: evt.loaded, total: evt.total, error: evt.error};\r\n            if (evt.result != null) e.target.result = evt.result;\r\n            return e;\r\n        };\r\n        var listener = function (evt) {\r\n            if (!loadStarted) {\r\n                loadStarted = true;\r\n                if (_this.onloadstart) _this.onloadstart(constructEvent('loadstart', evt));\r\n            }\r\n            var e;\r\n            if (evt.type === 'load') {\r\n                if (_this.onloadend) _this.onloadend(constructEvent('loadend', evt));\r\n                e = constructEvent('load', evt);\r\n                if (_this.onload) _this.onload(e);\r\n                _this.dispatchEvent(e);\r\n            } else if (evt.type === 'progress') {\r\n                e = constructEvent('progress', evt);\r\n                if (_this.onprogress) _this.onprogress(e);\r\n                _this.dispatchEvent(e);\r\n            } else {\r\n                e = constructEvent('error', evt);\r\n                if (_this.onerror) _this.onerror(e);\r\n                _this.dispatchEvent(e);\r\n            }\r\n        };\r\n        this.readAsArrayBuffer = function (file) {\r\n            FileAPI.readAsBinaryString(file, listener);\r\n        };\r\n        this.readAsBinaryString = function (file) {\r\n            FileAPI.readAsBinaryString(file, listener);\r\n        };\r\n        this.readAsDataURL = function (file) {\r\n            FileAPI.readAsDataURL(file, listener);\r\n        };\r\n        this.readAsText = function (file) {\r\n            FileAPI.readAsText(file, listener);\r\n        };\r\n    };\r\n}\r\n\r\n/**!\r\n * AngularJS file upload/drop directive and service with progress and abort\r\n * @author  Danial  <danial.farid@gmail.com>\r\n * @version 6.0.2\r\n */\r\n\r\nif (window.XMLHttpRequest && !(window.FileAPI && FileAPI.shouldLoad)) {\r\n    window.XMLHttpRequest.prototype.setRequestHeader = (function (orig) {\r\n        return function (header, value) {\r\n            if (header === '__setXHR_') {\r\n                var val = value(this);\r\n                // fix for angular < 1.2.0\r\n                if (val instanceof Function) {\r\n                    val(this);\r\n                }\r\n            } else {\r\n                orig.apply(this, arguments);\r\n            }\r\n        };\r\n    })(window.XMLHttpRequest.prototype.setRequestHeader);\r\n}\r\n\r\nvar ngFileUpload = angular.module('ngFileUpload', []);\r\n\r\nngFileUpload.version = '6.0.2';\r\nngFileUpload.defaults = {};\r\n\r\nngFileUpload.service('Upload', ['$http', '$q', '$timeout', function ($http, $q, $timeout) {\r\n    function sendHttp(config) {\r\n        config.method = config.method || 'POST';\r\n        config.headers = config.headers || {};\r\n\r\n        var deferred = $q.defer();\r\n        var promise = deferred.promise;\r\n\r\n        config.headers.__setXHR_ = function () {\r\n            return function (xhr) {\r\n                if (!xhr) return;\r\n                config.__XHR = xhr;\r\n                if (config.xhrFn) config.xhrFn(xhr);\r\n                xhr.upload.addEventListener('progress', function (e) {\r\n                    e.config = config;\r\n                    if (deferred.notify) {\r\n                        deferred.notify(e);\r\n                    } else if (promise.progressFunc) {\r\n                        $timeout(function () {\r\n                            promise.progressFunc(e);\r\n                        });\r\n                    }\r\n                }, false);\r\n                //fix for firefox not firing upload progress end, also IE8-9\r\n                xhr.upload.addEventListener('load', function (e) {\r\n                    if (e.lengthComputable) {\r\n                        e.config = config;\r\n                        if (deferred.notify) {\r\n                            deferred.notify(e);\r\n                        } else if (promise.progressFunc) {\r\n                            $timeout(function () {\r\n                                promise.progressFunc(e);\r\n                            });\r\n                        }\r\n                    }\r\n                }, false);\r\n            };\r\n        };\r\n\r\n        $http(config).then(function (r) {\r\n            deferred.resolve(r);\r\n        }, function (e) {\r\n            deferred.reject(e);\r\n        }, function (n) {\r\n            deferred.notify(n);\r\n        });\r\n\r\n        promise.success = function (fn) {\r\n            promise.then(function (response) {\r\n                fn(response.data, response.status, response.headers, config);\r\n            });\r\n            return promise;\r\n        };\r\n\r\n        promise.error = function (fn) {\r\n            promise.then(null, function (response) {\r\n                fn(response.data, response.status, response.headers, config);\r\n            });\r\n            return promise;\r\n        };\r\n\r\n        promise.progress = function (fn) {\r\n            promise.progressFunc = fn;\r\n            promise.then(null, null, function (update) {\r\n                fn(update);\r\n            });\r\n            return promise;\r\n        };\r\n        promise.abort = function () {\r\n            if (config.__XHR) {\r\n                $timeout(function () {\r\n                    config.__XHR.abort();\r\n                });\r\n            }\r\n            return promise;\r\n        };\r\n        promise.xhr = function (fn) {\r\n            config.xhrFn = (function (origXhrFn) {\r\n                return function () {\r\n                    if (origXhrFn) origXhrFn.apply(promise, arguments);\r\n                    fn.apply(promise, arguments);\r\n                };\r\n            })(config.xhrFn);\r\n            return promise;\r\n        };\r\n\r\n        return promise;\r\n    }\r\n\r\n    this.upload = function (config) {\r\n        function addFieldToFormData(formData, val, key) {\r\n            if (val !== undefined) {\r\n                if (angular.isDate(val)) {\r\n                    val = val.toISOString();\r\n                }\r\n                if (angular.isString(val)) {\r\n                    formData.append(key, val);\r\n                } else if (config.sendFieldsAs === 'form') {\r\n                    if (angular.isObject(val)) {\r\n                        for (var k in val) {\r\n                            if (val.hasOwnProperty(k)) {\r\n                                addFieldToFormData(formData, val[k], key + '[' + k + ']');\r\n                            }\r\n                        }\r\n                    } else {\r\n                        formData.append(key, val);\r\n                    }\r\n                } else {\r\n                    val = angular.isString(val) ? val : JSON.stringify(val);\r\n                    if (config.sendFieldsAs === 'json-blob') {\r\n                        formData.append(key, new Blob([val], {type: 'application/json'}));\r\n                    } else {\r\n                        formData.append(key, val);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        config.headers = config.headers || {};\r\n        config.headers['Content-Type'] = undefined;\r\n        config.transformRequest = config.transformRequest ?\r\n            (angular.isArray(config.transformRequest) ?\r\n                config.transformRequest : [config.transformRequest]) : [];\r\n        config.transformRequest.push(function (data) {\r\n            var formData = new FormData();\r\n            var allFields = {};\r\n            var key;\r\n            for (key in config.fields) {\r\n                if (config.fields.hasOwnProperty(key)) {\r\n                    allFields[key] = config.fields[key];\r\n                }\r\n            }\r\n            if (data) allFields.data = data;\r\n            for (key in allFields) {\r\n                if (allFields.hasOwnProperty(key)) {\r\n                    var val = allFields[key];\r\n                    if (config.formDataAppender) {\r\n                        config.formDataAppender(formData, key, val);\r\n                    } else {\r\n                        addFieldToFormData(formData, val, key);\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (config.file != null) {\r\n                var fileFormName = config.fileFormDataName || 'file';\r\n\r\n                if (angular.isArray(config.file)) {\r\n                    var isFileFormNameString = angular.isString(fileFormName);\r\n                    for (var i = 0; i < config.file.length; i++) {\r\n                        formData.append(isFileFormNameString ? fileFormName : fileFormName[i], config.file[i],\r\n                            (config.fileName && config.fileName[i]) || config.file[i].name);\r\n                    }\r\n                } else {\r\n                    formData.append(fileFormName, config.file, config.fileName || config.file.name);\r\n                }\r\n            }\r\n            return formData;\r\n        });\r\n\r\n        return sendHttp(config);\r\n    };\r\n\r\n    this.http = function (config) {\r\n        config.transformRequest = config.transformRequest || function (data) {\r\n                if ((window.ArrayBuffer && data instanceof window.ArrayBuffer) || data instanceof Blob) {\r\n                    return data;\r\n                }\r\n                return $http.defaults.transformRequest[0](arguments);\r\n            };\r\n        return sendHttp(config);\r\n    };\r\n\r\n    this.dataUrl = function (file, callback, disallowObjectUrl) {\r\n        if (window.FileReader && file &&\r\n            (!window.FileAPI || navigator.userAgent.indexOf('MSIE 8') === -1 || file.size < 20000) &&\r\n            (!window.FileAPI || navigator.userAgent.indexOf('MSIE 9') === -1 || file.size < 4000000)) {\r\n            $timeout(function () {\r\n                //prefer URL.createObjectURL for handling refrences to files of all sizes\r\n                //since it doesn´t build a large string in memory\r\n                var URL = window.URL || window.webkitURL;\r\n                if (URL && URL.createObjectURL && !disallowObjectUrl) {\r\n                    callback(URL.createObjectURL(file));\r\n                } else {\r\n                    var fileReader = new FileReader();\r\n                    fileReader.readAsDataURL(file);\r\n                    fileReader.onload = function (e) {\r\n                        $timeout(function () {\r\n                            callback(e.target.result);\r\n                        });\r\n                    };\r\n                }\r\n            });\r\n        } else {\r\n            callback(null);\r\n        }\r\n    };\r\n\r\n    this.setDefaults = function(defaults) {\r\n        ngFileUpload.defaults = defaults || {};\r\n    };\r\n}\r\n\r\n]);\r\n\r\n(function () {\r\n    ngFileUpload.getAttrWithDefaults = function(attr, name) {\r\n        return attr[name] != null ? attr[name] :\r\n            (ngFileUpload.defaults[name] == null ?\r\n                ngFileUpload.defaults[name] : ngFileUpload.defaults[name].toString());\r\n    };\r\n\r\n    var getAttr = ngFileUpload.getAttrWithDefaults;\r\n\r\n    ngFileUpload.directive('ngfSelect', ['$parse', '$timeout', '$compile',\r\n        function ($parse, $timeout, $compile) {\r\n            return {\r\n                restrict: 'AEC',\r\n                require: '?ngModel',\r\n                link: function (scope, elem, attr, ngModel) {\r\n                    linkFileSelect(scope, elem, attr, ngModel, $parse, $timeout, $compile);\r\n                }\r\n            };\r\n        }]);\r\n\r\n    function linkFileSelect(scope, elem, attr, ngModel, $parse, $timeout, $compile) {\r\n        /** @module attr.ngfSelect */\r\n        /** @module attr.ngfChange */\r\n        /** @module attr.ngModel */\r\n        /** @module attr.ngModelRejected */\r\n        /** @module attr.ngfModel */\r\n        /** @module attr.ngfMultiple */\r\n        /** @module attr.ngfCapture */\r\n        /** @module attr.ngfAccept */\r\n        /** @module attr.ngfMaxSize */\r\n        /** @module attr.ngfMinSize */\r\n        /** @module attr.ngfResetOnClick */\r\n        /** @module attr.ngfResetModelOnClick */\r\n        /** @module attr.ngfKeep */\r\n        /** @module attr.ngfKeepDistinct */\r\n\r\n        if (elem.attr('__ngf_gen__')) {\r\n            return;\r\n        }\r\n\r\n        scope.$on('$destroy', function () {\r\n            if (elem.$$ngfRefElem) elem.$$ngfRefElem.remove();\r\n        });\r\n\r\n        var disabled = false;\r\n        if (getAttr(attr, 'ngfSelect').search(/\\W+$files\\W+/) === -1) {\r\n            scope.$watch(getAttr(attr, 'ngfSelect'), function (val) {\r\n                disabled = val === false;\r\n            });\r\n        }\r\n        function isInputTypeFile() {\r\n            return elem[0].tagName.toLowerCase() === 'input' && attr.type && attr.type.toLowerCase() === 'file';\r\n        }\r\n\r\n        var isUpdating = false;\r\n\r\n        function changeFn(evt) {\r\n            if (!isUpdating) {\r\n                isUpdating = true;\r\n                try {\r\n                    var fileList = evt.__files_ || (evt.target && evt.target.files);\r\n                    var files = [], rejFiles = [];\r\n\r\n                    for (var i = 0; i < fileList.length; i++) {\r\n                        var file = fileList.item(i);\r\n                        if (validate(scope, $parse, attr, file, evt)) {\r\n                            files.push(file);\r\n                        } else {\r\n                            rejFiles.push(file);\r\n                        }\r\n                    }\r\n                    updateModel($parse, $timeout, scope, ngModel, attr,\r\n                        getAttr(attr, 'ngfChange') || getAttr(attr, 'ngfSelect'), files, rejFiles, evt);\r\n                    if (files.length === 0) evt.target.value = files;\r\n//                if (evt.target && evt.target.getAttribute('__ngf_gen__')) {\r\n//                    angular.element(evt.target).remove();\r\n//                }\r\n                } finally {\r\n                    isUpdating = false;\r\n                }\r\n            }\r\n        }\r\n\r\n        function bindAttrToFileInput(fileElem) {\r\n            if (getAttr(attr, 'ngfMultiple')) fileElem.attr('multiple', $parse(getAttr(attr, 'ngfMultiple'))(scope));\r\n            if (getAttr(attr, 'ngfCapture')) fileElem.attr('capture', $parse(getAttr(attr, 'ngfCapture'))(scope));\r\n            if (getAttr(attr, 'accept')) fileElem.attr('accept', getAttr(attr, 'accept'));\r\n            for (var i = 0; i < elem[0].attributes.length; i++) {\r\n                var attribute = elem[0].attributes[i];\r\n                if ((isInputTypeFile() && attribute.name !== 'type') ||\r\n                    (attribute.name !== 'type' && attribute.name !== 'class' &&\r\n                    attribute.name !== 'id' && attribute.name !== 'style')) {\r\n                    if (attribute.value == null || attribute.value === '') {\r\n                        if (attribute.name === 'required') attribute.value = 'required';\r\n                        if (attribute.name === 'multiple') attribute.value = 'multiple';\r\n                    }\r\n                    fileElem.attr(attribute.name, attribute.value);\r\n                }\r\n            }\r\n        }\r\n\r\n        function createFileInput(evt, resetOnClick) {\r\n            if (!resetOnClick && (evt || isInputTypeFile())) return elem.$$ngfRefElem || elem;\r\n\r\n            var fileElem = angular.element('<input type=\"file\">');\r\n            bindAttrToFileInput(fileElem);\r\n\r\n            if (isInputTypeFile()) {\r\n                elem.replaceWith(fileElem);\r\n                elem = fileElem;\r\n                fileElem.attr('__ngf_gen__', true);\r\n                $compile(elem)(scope);\r\n            } else {\r\n                fileElem.css('visibility', 'hidden').css('position', 'absolute').css('overflow', 'hidden')\r\n                    .css('width', '0px').css('height', '0px').css('z-index', '-100000').css('border', 'none')\r\n                    .css('margin', '0px').css('padding', '0px').attr('tabindex', '-1');\r\n                if (elem.$$ngfRefElem) {\r\n                    elem.$$ngfRefElem.remove();\r\n                }\r\n                elem.$$ngfRefElem = fileElem;\r\n                document.body.appendChild(fileElem[0]);\r\n            }\r\n\r\n            return fileElem;\r\n        }\r\n\r\n        function resetModel(evt) {\r\n            updateModel($parse, $timeout, scope, ngModel, attr,\r\n                getAttr(attr, 'ngfChange') || getAttr(attr, 'ngfSelect'), [], [], evt, true);\r\n        }\r\n\r\n        var initialTouchStartY = 0;\r\n\r\n        function clickHandler(evt) {\r\n            if (elem.attr('disabled') || disabled) return false;\r\n\r\n            if (evt != null) {\r\n                if (evt.type === 'touchstart') {\r\n                    initialTouchStartY = evt.originalEvent.touches[0].clientY;\r\n                    return true; // don't block event default\r\n                } else {\r\n                    evt.stopPropagation();\r\n                    evt.preventDefault();\r\n\r\n                    // prevent scroll from triggering event\r\n                    if (evt.type === 'touchend') {\r\n                        var currentLocation = evt.originalEvent.changedTouches[0].clientY;\r\n                        if (Math.abs(currentLocation - initialTouchStartY) > 20) return false;\r\n                    }\r\n                }\r\n            }\r\n\r\n            var resetOnClick = $parse(getAttr(attr, 'ngfResetOnClick'))(scope) !== false;\r\n            var fileElem = createFileInput(evt, resetOnClick);\r\n\r\n            function clickAndAssign(evt) {\r\n                if (evt && evt.clientY > 0) {\r\n                    fileElem[0].click();\r\n                }\r\n                if ((isInputTypeFile() || !evt) && resetOnClick) {\r\n                    elem.bind('click touchend touchstart', clickHandler);\r\n                }\r\n            }\r\n\r\n            if (fileElem) {\r\n                if (!evt || resetOnClick) fileElem.bind('change', changeFn);\r\n                if (evt && resetOnClick && $parse(getAttr(attr, 'ngfResetModelOnClick'))(scope) !== false) {\r\n                    resetModel(evt);\r\n                }\r\n\r\n                // fix for android native browser < 4.4\r\n                if (shouldClickLater(navigator.userAgent)) {\r\n                    setTimeout(function () {\r\n                        clickAndAssign(evt);\r\n                    }, 0);\r\n                } else {\r\n                    clickAndAssign(evt);\r\n                }\r\n            }\r\n\r\n            return false;\r\n        }\r\n\r\n        if (window.FileAPI && window.FileAPI.ngfFixIE) {\r\n            window.FileAPI.ngfFixIE(elem, createFileInput, bindAttrToFileInput, changeFn);\r\n        } else {\r\n            clickHandler();\r\n            //if (!isInputTypeFile()) {\r\n            //  elem.bind('click touchend', clickHandler);\r\n            //}\r\n        }\r\n    }\r\n\r\n    function shouldClickLater(ua) {\r\n        // android below 4.4\r\n        var m = ua.match(/Android[^\\d]*(\\d+)\\.(\\d+)/);\r\n        if (m && m.length > 2) {\r\n            var v = ngFileUpload.defaults.androidFixMinorVersion || 4;\r\n            return parseInt(m[1]) < 4 || (parseInt(m[1]) === v && parseInt(m[2]) < v);\r\n        }\r\n\r\n        // safari on windows\r\n        return ua.indexOf('Chrome') === -1 && /.*Windows.*Safari.*/.test(ua);\r\n    }\r\n\r\n    ngFileUpload.validate = function (scope, $parse, attr, file, evt) {\r\n        if (file == null) {\r\n            return false;\r\n        }\r\n        function globStringToRegex(str) {\r\n            if (str.length > 2 && str[0] === '/' && str[str.length - 1] === '/') {\r\n                return str.substring(1, str.length - 1);\r\n            }\r\n            var split = str.split(','), result = '';\r\n            if (split.length > 1) {\r\n                for (var i = 0; i < split.length; i++) {\r\n                    result += '(' + globStringToRegex(split[i]) + ')';\r\n                    if (i < split.length - 1) {\r\n                        result += '|';\r\n                    }\r\n                }\r\n            } else {\r\n                if (str.indexOf('.') === 0) {\r\n                    str = '*' + str;\r\n                }\r\n                result = '^' + str.replace(new RegExp('[.\\\\\\\\+*?\\\\[\\\\^\\\\]$(){}=!<>|:\\\\' + '-]', 'g'), '\\\\$&') + '$';\r\n                result = result.replace(/\\\\\\*/g, '.*').replace(/\\\\\\?/g, '.');\r\n            }\r\n            return result;\r\n        }\r\n\r\n        var accept = $parse(getAttr(attr, 'ngfAccept'))(scope, {$file: file, $event: evt});\r\n        var fileSizeMax = $parse(getAttr(attr, 'ngfMaxSize'))(scope, {$file: file, $event: evt}) || 9007199254740991;\r\n        var fileSizeMin = $parse(getAttr(attr, 'ngfMinSize'))(scope, {$file: file, $event: evt}) || -1;\r\n        if (accept != null && angular.isString(accept)) {\r\n            var regexp = new RegExp(globStringToRegex(accept), 'gi');\r\n            accept = (file.type != null && regexp.test(file.type.toLowerCase())) ||\r\n                (file.name != null && regexp.test(file.name.toLowerCase()));\r\n            if (!accept) {\r\n                file.$error = 'accept';\r\n                return false;\r\n            }\r\n        } else {\r\n            if (accept === false) {\r\n                file.$error = 'accept';\r\n                return false;\r\n            }\r\n        }\r\n        if (file.size == null) return true;\r\n        if (file.size > fileSizeMax) {\r\n            file.$error = 'maxSize';\r\n            return false;\r\n        }\r\n        if (file.size < fileSizeMin) {\r\n            file.$error = 'minSize';\r\n            return false;\r\n        }\r\n        return true;\r\n    };\r\n\r\n    ngFileUpload.updateModel = function ($parse, $timeout, scope, ngModel, attr, fileChange,\r\n                                         files, rejFiles, evt, noDelay) {\r\n        function update() {\r\n            var keep = $parse(getAttr(attr, 'ngfKeep'))(scope);\r\n            if (keep === true) {\r\n                var prevFiles = (ngModel.$modelValue || []).slice(0);\r\n                if (!files || !files.length) {\r\n                    files = prevFiles;\r\n                } else if ($parse(getAttr(attr, 'ngfKeepDistinct'))(scope) === true) {\r\n                    var len = prevFiles.length;\r\n                    for (var i = 0; i < files.length; i++) {\r\n                        for (var j = 0; j < len; j++) {\r\n                            if (files[i].name === prevFiles[j].name) break;\r\n                        }\r\n                        if (j === len) {\r\n                            prevFiles.push(files[i]);\r\n                        }\r\n                    }\r\n                    files = prevFiles;\r\n                } else {\r\n                    files = prevFiles.concat(files);\r\n                }\r\n            }\r\n            var file = files && files.length ? files[0] : null;\r\n            if (ngModel) {\r\n                var singleModel = !$parse(getAttr(attr, 'ngfMultiple'))(scope) && ! getAttr(attr, 'multiple') && !keep;\r\n                $parse(getAttr(attr, 'ngModel')).assign(scope, singleModel ? file : files);\r\n                $timeout(function () {\r\n                    if (ngModel) {\r\n                        ngModel.$setViewValue(singleModel ? file : (files != null && files.length === 0 ? null : files));\r\n                    }\r\n                });\r\n            }\r\n            var ngfModel = getAttr(attr, 'ngfModel');\r\n            if (ngfModel) {\r\n                $parse(ngfModel).assign(scope, files);\r\n            }\r\n\r\n            if (getAttr(attr, 'ngModelRejected')) {\r\n                $parse(getAttr(attr, 'ngModelRejected')).assign(scope, rejFiles);\r\n            }\r\n            if (fileChange) {\r\n                $parse(fileChange)(scope, {\r\n                    $files: files,\r\n                    $file: file,\r\n                    $rejectedFiles: rejFiles,\r\n                    $event: evt\r\n                });\r\n            }\r\n        }\r\n\r\n        if (noDelay) {\r\n            update();\r\n        } else {\r\n            $timeout(function () {\r\n                update();\r\n            });\r\n        }\r\n    };\r\n\r\n    var validate = ngFileUpload.validate;\r\n    var updateModel = ngFileUpload.updateModel;\r\n\r\n})();\r\n\r\n(function () {\r\n    var validate = ngFileUpload.validate;\r\n    var updateModel = ngFileUpload.updateModel;\r\n    var getAttr = ngFileUpload.getAttrWithDefaults;\r\n\r\n    ngFileUpload.directive('ngfDrop', ['$parse', '$timeout', '$location', function ($parse, $timeout, $location) {\r\n        return {\r\n            restrict: 'AEC',\r\n            require: '?ngModel',\r\n            link: function (scope, elem, attr, ngModel) {\r\n                linkDrop(scope, elem, attr, ngModel, $parse, $timeout, $location);\r\n            }\r\n        };\r\n    }]);\r\n\r\n    ngFileUpload.directive('ngfNoFileDrop', function () {\r\n        return function (scope, elem) {\r\n            if (dropAvailable()) elem.css('display', 'none');\r\n        };\r\n    });\r\n\r\n    ngFileUpload.directive('ngfDropAvailable', ['$parse', '$timeout', function ($parse, $timeout) {\r\n        return function (scope, elem, attr) {\r\n            if (dropAvailable()) {\r\n                var fn = $parse(getAttr(attr, 'ngfDropAvailable'));\r\n                $timeout(function () {\r\n                    fn(scope);\r\n                    if (fn.assign) {\r\n                        fn.assign(scope, true);\r\n                    }\r\n                });\r\n            }\r\n        };\r\n    }]);\r\n\r\n    function linkDrop(scope, elem, attr, ngModel, $parse, $timeout, $location) {\r\n        var available = dropAvailable();\r\n        if (getAttr(attr, 'dropAvailable')) {\r\n            $timeout(function () {\r\n                if (scope[getAttr(attr, 'dropAvailable')]) {\r\n                    scope[getAttr(attr, 'dropAvailable')].value = available;\r\n                } else {\r\n                    scope[getAttr(attr, 'dropAvailable')] = available;\r\n                }\r\n            });\r\n        }\r\n        if (!available) {\r\n            if ($parse(getAttr(attr, 'ngfHideOnDropNotAvailable'))(scope) === true) {\r\n                elem.css('display', 'none');\r\n            }\r\n            return;\r\n        }\r\n\r\n        var disabled = false;\r\n        if (getAttr(attr, 'ngfDrop').search(/\\W+$files\\W+/) === -1) {\r\n            scope.$watch(getAttr(attr, 'ngfDrop'), function(val) {\r\n                disabled = val === false;\r\n            });\r\n        }\r\n\r\n        var leaveTimeout = null;\r\n        var stopPropagation = $parse(getAttr(attr, 'ngfStopPropagation'));\r\n        var dragOverDelay = 1;\r\n        var actualDragOverClass;\r\n\r\n        elem[0].addEventListener('dragover', function (evt) {\r\n            if (elem.attr('disabled') || disabled) return;\r\n            evt.preventDefault();\r\n            if (stopPropagation(scope)) evt.stopPropagation();\r\n            // handling dragover events from the Chrome download bar\r\n            if (navigator.userAgent.indexOf('Chrome') > -1) {\r\n                var b = evt.dataTransfer.effectAllowed;\r\n                evt.dataTransfer.dropEffect = ('move' === b || 'linkMove' === b) ? 'move' : 'copy';\r\n            }\r\n            $timeout.cancel(leaveTimeout);\r\n            if (!scope.actualDragOverClass) {\r\n                actualDragOverClass = calculateDragOverClass(scope, attr, evt);\r\n            }\r\n            elem.addClass(actualDragOverClass);\r\n        }, false);\r\n        elem[0].addEventListener('dragenter', function (evt) {\r\n            if (elem.attr('disabled') || disabled) return;\r\n            evt.preventDefault();\r\n            if (stopPropagation(scope)) evt.stopPropagation();\r\n        }, false);\r\n        elem[0].addEventListener('dragleave', function () {\r\n            if (elem.attr('disabled') || disabled) return;\r\n            leaveTimeout = $timeout(function () {\r\n                elem.removeClass(actualDragOverClass);\r\n                actualDragOverClass = null;\r\n            }, dragOverDelay || 1);\r\n        }, false);\r\n        elem[0].addEventListener('drop', function (evt) {\r\n            if (elem.attr('disabled') || disabled) return;\r\n            evt.preventDefault();\r\n            if (stopPropagation(scope)) evt.stopPropagation();\r\n            elem.removeClass(actualDragOverClass);\r\n            actualDragOverClass = null;\r\n            extractFiles(evt, function (files, rejFiles) {\r\n                    updateModel($parse, $timeout, scope, ngModel, attr,\r\n                        getAttr(attr, 'ngfChange') || getAttr(attr, 'ngfDrop'), files, rejFiles, evt);\r\n                }, $parse(getAttr(attr, 'ngfAllowDir'))(scope) !== false,\r\n                getAttr(attr, 'multiple') || $parse(getAttr(attr, 'ngfMultiple'))(scope));\r\n        }, false);\r\n\r\n        function calculateDragOverClass(scope, attr, evt) {\r\n            var accepted = true;\r\n            var items = evt.dataTransfer.items;\r\n            if (items != null) {\r\n                for (var i = 0; i < items.length && accepted; i++) {\r\n                    accepted = accepted &&\r\n                        (items[i].kind === 'file' || items[i].kind === '') &&\r\n                        validate(scope, $parse, attr, items[i], evt);\r\n                }\r\n            }\r\n            var clazz = $parse(getAttr(attr, 'ngfDragOverClass'))(scope, {$event: evt});\r\n            if (clazz) {\r\n                if (clazz.delay) dragOverDelay = clazz.delay;\r\n                if (clazz.accept) clazz = accepted ? clazz.accept : clazz.reject;\r\n            }\r\n            return clazz || getAttr(attr, 'ngfDragOverClass') || 'dragover';\r\n        }\r\n\r\n        function extractFiles(evt, callback, allowDir, multiple) {\r\n            var files = [], rejFiles = [], items = evt.dataTransfer.items, processing = 0;\r\n\r\n            function addFile(file) {\r\n                if (validate(scope, $parse, attr, file, evt)) {\r\n                    files.push(file);\r\n                } else {\r\n                    rejFiles.push(file);\r\n                }\r\n            }\r\n\r\n            function traverseFileTree(files, entry, path) {\r\n                if (entry != null) {\r\n                    if (entry.isDirectory) {\r\n                        var filePath = (path || '') + entry.name;\r\n                        addFile({name: entry.name, type: 'directory', path: filePath});\r\n                        var dirReader = entry.createReader();\r\n                        var entries = [];\r\n                        processing++;\r\n                        var readEntries = function () {\r\n                            dirReader.readEntries(function (results) {\r\n                                try {\r\n                                    if (!results.length) {\r\n                                        for (var i = 0; i < entries.length; i++) {\r\n                                            traverseFileTree(files, entries[i], (path ? path : '') + entry.name + '/');\r\n                                        }\r\n                                        processing--;\r\n                                    } else {\r\n                                        entries = entries.concat(Array.prototype.slice.call(results || [], 0));\r\n                                        readEntries();\r\n                                    }\r\n                                } catch (e) {\r\n                                    processing--;\r\n                                    console.error(e);\r\n                                }\r\n                            }, function () {\r\n                                processing--;\r\n                            });\r\n                        };\r\n                        readEntries();\r\n                    } else {\r\n                        processing++;\r\n                        entry.file(function (file) {\r\n                            try {\r\n                                processing--;\r\n                                file.path = (path ? path : '') + file.name;\r\n                                addFile(file);\r\n                            } catch (e) {\r\n                                processing--;\r\n                                console.error(e);\r\n                            }\r\n                        }, function () {\r\n                            processing--;\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (items && items.length > 0 && $location.protocol() !== 'file') {\r\n                for (var i = 0; i < items.length; i++) {\r\n                    if (items[i].webkitGetAsEntry && items[i].webkitGetAsEntry() && items[i].webkitGetAsEntry().isDirectory) {\r\n                        var entry = items[i].webkitGetAsEntry();\r\n                        if (entry.isDirectory && !allowDir) {\r\n                            continue;\r\n                        }\r\n                        if (entry != null) {\r\n                            traverseFileTree(files, entry);\r\n                        }\r\n                    } else {\r\n                        var f = items[i].getAsFile();\r\n                        if (f != null) addFile(f);\r\n                    }\r\n                    if (!multiple && files.length > 0) break;\r\n                }\r\n            } else {\r\n                var fileList = evt.dataTransfer.files;\r\n                if (fileList != null) {\r\n                    for (var j = 0; j < fileList.length; j++) {\r\n                        addFile(fileList.item(j));\r\n                        if (!multiple && files.length > 0) {\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            var delays = 0;\r\n            (function waitForProcess(delay) {\r\n                $timeout(function () {\r\n                    if (!processing) {\r\n                        if (!multiple && files.length > 1) {\r\n                            i = 0;\r\n                            while (files[i].type === 'directory') i++;\r\n                            files = [files[i]];\r\n                        }\r\n                        callback(files, rejFiles);\r\n                    } else {\r\n                        if (delays++ * 10 < 20 * 1000) {\r\n                            waitForProcess(10);\r\n                        }\r\n                    }\r\n                }, delay || 0);\r\n            })();\r\n        }\r\n    }\r\n\r\n    function dropAvailable() {\r\n        var div = document.createElement('div');\r\n        return ('draggable' in div) && ('ondrop' in div);\r\n    }\r\n\r\n})();\r\n\r\n(function () {\r\n\r\n    function fileToSrc(Upload, scope, $parse, attr, name, defaultName, callback) {\r\n        scope.$watch(name, function (file) {\r\n            if (!angular.isString(file)) {\r\n                if (window.FileReader && ngFileUpload.validate(scope, $parse, attr, file, null)) {\r\n                    Upload.dataUrl(file, function (url) {\r\n                        if (callback) {\r\n                            callback(url);\r\n                        } else {\r\n                            file.dataUrl = url || $parse(defaultName)(scope);\r\n                        }\r\n                    }, $parse(attr.ngfNoObjectUrl)(scope));\r\n                }\r\n            } else {\r\n                callback(file);\r\n            }\r\n        });\r\n    }\r\n\r\n    /** @module attr.ngfSrc */\r\n    /** @module attr.ngfDefaultSrc */\r\n    /** @module attr.ngfNoObjectUrl */\r\n    ngFileUpload.directive('ngfSrc', ['$parse', 'Upload', function ($parse, Upload) {\r\n        return {\r\n            restrict: 'AE',\r\n            link: function (scope, elem, attr) {\r\n                fileToSrc(Upload, scope, $parse, attr, attr.ngfSrc, attr.ngfDefaultSrc, function (url) {\r\n                    elem.attr('src', url);\r\n                });\r\n            }\r\n        };\r\n    }]);\r\n\r\n    /** @module attr.ngfBackground */\r\n    /** @module attr.ngfDefaultBackground */\r\n    /** @module attr.ngfNoObjectUrl */\r\n    ngFileUpload.directive('ngfBackground', ['$parse', 'Upload', function ($parse, Upload) {\r\n        return {\r\n            restrict: 'AE',\r\n            link: function (scope, elem, attr) {\r\n                fileToSrc(Upload, scope, $parse, attr, attr.ngfBackground, attr.ngfDefaultBackground, function (url) {\r\n                    elem.css('background-image', 'url(' + url + ')');\r\n                });\r\n            }\r\n        };\r\n    }]);\r\n\r\n    /** @module attr.ngfDataUrl */\r\n    /** @module attr.ngfDefaultDataUrl */\r\n    /** @module attr.ngfNoObjectUrl */\r\n    ngFileUpload.directive('ngfDataUrl', ['$parse', 'Upload', function ($parse, Upload) {\r\n        return {\r\n            restrict: 'AE',\r\n            link: function (scope, elem, attr) {\r\n\r\n                fileToSrc(Upload, scope, $parse, attr, attr.ngfDataUrl, attr.ngfDefaultDataUrl);\r\n            }\r\n        };\r\n    }]);\r\n})();"],"sourceRoot":"/source/"}